import{x as v,w as he,k as E,o as Ve,e as $e,ac as r,ad as f,ae as s,l as u,af as n,ag as o,ah as Re,ai as D,F as H,aj as X,E as Z,X as i,ak as M,al as _,J as ee,am as te,an as _e,V as A,ao as Be}from"./vendor-aa91f45f.js";import{A as Ae,I as Ne,_ as Fe,B as Je,C as We,a as Qe,b as Ye,S as Ge,c as Ke,d as Xe,e as Ze}from"./vendor-antd-9d62bf7e.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))T(c);new MutationObserver(c=>{for(const p of c)if(p.type==="childList")for(const k of p.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&T(k)}).observe(document,{childList:!0,subtree:!0});function w(c){const p={};return c.integrity&&(p.integrity=c.integrity),c.referrerPolicy&&(p.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?p.credentials="include":c.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function T(c){if(c.ep)return;c.ep=!0;const p=w(c);fetch(c.href,p)}})();const et={id:"app-container"},tt={class:"sidebar"},st={class:"brand"},lt={class:"filter-section"},nt={class:"search-wrapper"},ot={class:"select-group"},at={class:"sub-filters"},it={style:{display:"flex",gap:"8px"}},rt={key:0},ut={key:1},dt={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"12px"}},ct={style:{"margin-top":"8px",display:"flex","justify-content":"space-between","font-size":"12px",color:"var(--text-secondary)"}},vt={style:{"margin-top":"4px","font-size":"12px",color:"var(--text-secondary)",display:"flex","align-items":"center",gap:"6px"}},pt={key:0,class:"pulse-dot"},ft={style:{display:"flex","flex-direction":"column",gap:"8px"}},gt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},mt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},yt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ht={class:"main"},_t={class:"navbar"},xt={style:{display:"flex","align-items":"center",gap:"12px"}},bt={style:{"font-weight":"600","font-size":"13px"}},wt=["onClick"],kt=["title"],Ct={class:"path-container"},Lt=["onClick"],St=["innerHTML"],Tt=["onClick"],It=["innerHTML"],Dt=["title","innerHTML"],zt={key:2,style:{color:"var(--text-secondary)",opacity:"0.7","font-style":"italic"}},Ot={class:"body-container"},qt={class:"col-meta"},Et={class:"row-actions"},Mt={key:0,class:"detail-content"},Pt={class:"detail-section"},jt={class:"detail-grid"},Ht={class:"grid-item"},Ut={class:"grid-item"},Vt={class:"grid-item"},$t={class:"grid-item"},Rt={class:"grid-item"},Bt={class:"detail-section"},At={class:"grid-item full"},Nt={class:"code-block"},Ft={key:0,class:"grid-item full"},Jt={class:"code-block"},Wt={key:1,class:"grid-item full"},Qt={class:"code-block"},Yt={class:"detail-section"},Gt={class:"detail-grid"},Kt={class:"grid-item"},Xt={class:"grid-item"},Zt={class:"grid-item"},es={class:"grid-item"},ts={class:"grid-item"},ss={class:"grid-item full",style:{"margin-top":"12px"}},ls={class:"ua-text"},ns={class:"detail-section"},os={class:"raw-pre"},N=36,se=2e3,as={__name:"App",setup(xe){const g=v([]),w=v([]),T=v([]),c=v(""),p=v(!1),k=v(!1),F=v({pv:0,uv:0}),y=v(null),be=v("access.log"),C=v(localStorage.getItem("theme")!=="light"),J=v(!1),d=v(null),le=v([]),ne=v([]),z=v(void 0),P=v(void 0),I=v(void 0),L=v(JSON.parse(localStorage.getItem("levelColors"))||{v:C.value?"#cccccc":"#000000",d:"#007acc",e:"#f44747"});he(L,t=>{localStorage.setItem("levelColors",JSON.stringify(t))},{deep:!0});const oe=v(0),ae=v(800),we=E(()=>Math.ceil(ae.value/N)+5),W=E(()=>Math.floor(oe.value/N)),ke=E(()=>Y.value.slice(W.value,W.value+we.value)),Ce=E(()=>Y.value.length*N),Le=E(()=>W.value*N),Se=t=>{oe.value=t.target.scrollTop},V=()=>{y.value&&(ae.value=y.value.clientHeight)},j=()=>{me(),K()};let $=null;const Te=()=>{if(T.value.length===0)return;const t=[...g.value,...T.value];T.value=[],t.length>se?g.value=t.slice(t.length-se):g.value=t,Z(()=>{if(y.value){const e=y.value;e.scrollHeight-e.scrollTop-e.clientHeight<200&&(e.scrollTop=e.scrollHeight)}})},Ie=t=>{if(t.level)return t.level;if(!t.query&&!t.path)return null;let e="";if(t.query&&t.query!=="-"?e=t.query:t.path&&t.path.includes("?")&&(e=t.path.split("?")[1]),!e)return null;const a=e.split("&");for(const x of a)if(x.startsWith("level="))return x.substring(6);return null},O=t=>{if(t.tag||t.level)return{tag:t.tag,text:t.query||t.path};if(!t.path||!t.path.startsWith("/log/"))return null;const e=t.query||(t.path.includes("?")?t.path.split("?")[1]:"");if(!e)return null;const a=new URLSearchParams(e);return{tag:a.get("tag"),text:a.get("text")}},ie=t=>{const e=Ie(t);return e&&L.value[e]?{color:L.value[e],fontWeight:e==="e"?"600":"normal"}:{}},Q=t=>{if(!c.value||!t)return t;const e=c.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=new RegExp(`(${e})`,"gi");return String(t).replace(a,'<mark class="hl">$1</mark>')},De=t=>t==="e"||t==="error"?"red":t==="d"||t==="debug"?"blue":"default",re=t=>{d.value=t,J.value=!0},ze=t=>{const e=JSON.stringify(t,null,2);navigator.clipboard.writeText(e).then(()=>{})},Oe=t=>{t.timeOnly=ve(t.time);const e=Object.freeze(t);if(p.value){w.value.push(e);return}T.value.push(e),$||($=setInterval(Te,100))},Y=E(()=>{let t=g.value;if(z.value&&(t=t.filter(a=>a.device_id===z.value)),P.value&&(t=t.filter(a=>a.level===P.value)),I.value&&(t=t.filter(a=>a.tag===I.value)),!c.value)return t;const e=c.value.toLowerCase();return t.filter(a=>a.path&&a.path.toLowerCase().includes(e)||a.ip&&a.ip.includes(e)||a.device_id&&a.device_id.toLowerCase().includes(e)||a.tag&&a.tag.toLowerCase().includes(e)||a.status&&String(a.status).includes(e))}),qe=E(()=>C.value?"#cccccc":"#333333"),Ee=()=>{C.value=!C.value,localStorage.setItem("theme",C.value?"dark":"light")};he(C,t=>{document.documentElement.setAttribute("data-theme",t?"dark":"light")},{immediate:!0});const ue=t=>{const e={GET:"#4ec9b0",POST:"#569cd6",PUT:"#dcdcaa",DELETE:"#f44747"};return C.value?e[t]||"#cccccc":{GET:"#059669",POST:"#2563eb",PUT:"#d97706",DELETE:"#dc2626"}[t]||"#666"},de=t=>t<300?"c-2xx":t<400?"c-3xx":t<500?"c-4xx":"c-5xx",G=t=>t?t.split("?")[0]:"",ce=t=>{let e="";if(t.query&&t.query!=="-"?(e=t.query,e.startsWith("?")&&(e=e.substring(1))):t.path&&t.path.includes("?")&&(e=t.path.split("?")[1]),!e)return"";try{return decodeURIComponent(e)}catch{return e}},ve=t=>{if(!t)return"--:--:--";const e=t.split(":");return e.length>=4?e.slice(1,4).join(":").split(" ")[0]:t};let R=null;const pe=()=>{const t=window.location.protocol==="https:"?"wss":"ws",e=window.location.host;R=new WebSocket(`${t}://${e}/ws`),R.onopen=()=>k.value=!0,R.onclose=()=>{k.value=!1,setTimeout(pe,2e3)},R.onmessage=a=>{try{Oe(JSON.parse(a.data))}catch{}}},Me=async()=>{try{F.value=await(await fetch("/api/stats")).json()}catch{}},fe=async()=>{try{le.value=await(await fetch("/api/devices")).json()}catch{}},ge=async()=>{try{ne.value=await(await fetch("/api/tags")).json()}catch{}},K=async()=>{try{const t=new URLSearchParams;z.value&&t.set("device",z.value),P.value&&t.set("level",P.value),I.value&&t.set("tag",I.value);const e=`/api/history?${t.toString()}`,x=await(await fetch(e)).json();x&&(g.value=x.reverse().map(h=>({...h,timeOnly:ve(h.time),id:h.id||Math.random()})).map(Object.freeze),Z(()=>{V(),y.value&&(y.value.scrollTop=y.value.scrollHeight)}))}catch{}},Pe=()=>{p.value=!p.value,p.value||(w.value.length>0&&(g.value=[...g.value,...w.value].slice(-se),w.value=[]),Z(()=>{y.value&&(y.value.scrollTop=y.value.scrollHeight)}))},me=()=>{g.value=[],w.value=[],T.value=[]},je=()=>{const t=Y.value;if(!t.length)return;const e=["ID","Time","Level","Tag","DeviceID","Method","Path","Status","IP"],a=t.map(m=>[m.id,m.time,m.level||"info",m.tag||"",m.device_id||"",m.method,m.path,m.status,m.ip]),x=[e.join(","),...a.map(m=>m.map(B=>`"${String(B).replace(/"/g,'""')}"`).join(","))].join(`
`),h=new Blob([x],{type:"text/csv;charset=utf-8;"}),b=document.createElement("a"),S=URL.createObjectURL(h);b.setAttribute("href",S),b.setAttribute("download",`logs_export_${new Date().getTime()}.csv`),b.style.visibility="hidden",document.body.appendChild(b),b.click(),document.body.removeChild(b)};return Ve(()=>{pe(),K(),fe(),ge(),setInterval(Me,5e3),setInterval(fe,1e4),setInterval(ge,15e3),V(),window.addEventListener("resize",V)}),$e(()=>{$&&clearInterval($),window.removeEventListener("resize",V)}),(t,e)=>{const a=Ae,x=Ne,h=Ge,b=Fe,S=Je,m=Ke,B=We,q=Qe,He=Xe,ye=Ze,Ue=Ye;return r(),f("div",et,[s("aside",tt,[s("div",st,[u(a,{size:32,shape:"square"},{default:n(()=>[...e[8]||(e[8]=[i("SS",-1)])]),_:1}),e[9]||(e[9]=s("span",null,"Sonic Stellar",-1))]),s("div",lt,[s("div",nt,[u(x,{value:c.value,"onUpdate:value":e[0]||(e[0]=l=>c.value=l),placeholder:"Search logs...","allow-clear":"",class:"modern-search"},{prefix:n(()=>[...e[10]||(e[10]=[i("ðŸ”",-1)])]),_:1},8,["value"])]),s("div",ot,[u(b,{value:z.value,"onUpdate:value":e[1]||(e[1]=l=>z.value=l),placeholder:"Device","show-search":"","allow-clear":"",onChange:j,class:"modern-select"},{suffixIcon:n(()=>[...e[11]||(e[11]=[i("ðŸ“±",-1)])]),default:n(()=>[(r(!0),f(H,null,X(le.value,l=>(r(),M(h,{key:l,value:l},{default:n(()=>[i(o(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",at,[u(b,{value:P.value,"onUpdate:value":e[2]||(e[2]=l=>P.value=l),placeholder:"Level","allow-clear":"",onChange:j,class:"modern-select level-select"},{suffixIcon:n(()=>[...e[12]||(e[12]=[i("ðŸ“Š",-1)])]),default:n(()=>[u(h,{value:"v"},{default:n(()=>[...e[13]||(e[13]=[i("Verbose",-1)])]),_:1}),u(h,{value:"d"},{default:n(()=>[...e[14]||(e[14]=[i("Debug",-1)])]),_:1}),u(h,{value:"e"},{default:n(()=>[...e[15]||(e[15]=[i("Error",-1)])]),_:1})]),_:1},8,["value"]),u(b,{value:I.value,"onUpdate:value":e[3]||(e[3]=l=>I.value=l),placeholder:"Tag","show-search":"","allow-clear":"",onChange:j,class:"modern-select tag-select"},{suffixIcon:n(()=>[...e[16]||(e[16]=[i("ðŸ·ï¸",-1)])]),default:n(()=>[(r(!0),f(H,null,X(ne.value,l=>(r(),M(h,{key:l,value:l},{default:n(()=>[i(o(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),s("div",it,[u(S,{type:"primary",danger:p.value,onClick:Pe,block:"",ghost:""},{icon:n(()=>[p.value?(r(),f("span",ut,"â–¶ï¸")):(r(),f("span",rt,"â¸"))]),default:n(()=>[i(" "+o(p.value?w.value.length>0?`Resume (${w.value.length})`:"Resume":"Pause"),1)]),_:1},8,["danger"]),u(S,{onClick:me,block:""},{default:n(()=>[...e[17]||(e[17]=[i(" ðŸ—‘ Clear ",-1)])]),_:1})]),u(B,{size:"small",bordered:!1,style:{background:"var(--card-bg)","margin-top":"auto"}},{default:n(()=>[s("div",dt,[e[18]||(e[18]=s("span",{style:{"font-size":"12px","font-weight":"600",color:"var(--text-secondary)"}},"STATISTICS",-1)),u(S,{type:"text",size:"small",onClick:Ee},{default:n(()=>[i(o(C.value?"ðŸŒ™":"â˜€ï¸"),1)]),_:1})]),u(m,{title:"Total Requests",value:F.value.pv,"value-style":{color:qe.value}},null,8,["value","value-style"]),s("div",ct,[e[19]||(e[19]=s("span",null,"Unique Visitors",-1)),s("span",null,o(F.value.uv),1)]),s("div",vt,[e[20]||(e[20]=i(" Status: ",-1)),s("span",{style:D({color:k.value?"#4ec9b0":"#f44747"})},o(k.value?"Live":"Offline"),5),k.value?(r(),f("div",pt)):_("",!0)]),u(S,{size:"small",type:"link",onClick:K,style:{padding:"0","margin-top":"8px"}},{default:n(()=>[...e[21]||(e[21]=[i("Load History",-1)])]),_:1})]),_:1}),u(B,{size:"small",bordered:!1,style:{background:"var(--card-bg)","margin-top":"12px"}},{default:n(()=>[e[25]||(e[25]=s("div",{style:{"font-size":"11px","font-weight":"600",color:"var(--text-secondary)","margin-bottom":"8px"}},"LEVEL COLORS ",-1)),s("div",ft,[s("div",gt,[e[22]||(e[22]=s("span",{style:{"font-size":"12px"}},"v (Verbose)",-1)),ee(s("input",{type:"color","onUpdate:modelValue":e[4]||(e[4]=l=>L.value.v=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[te,L.value.v]])]),s("div",mt,[e[23]||(e[23]=s("span",{style:{"font-size":"12px"}},"d (Debug)",-1)),ee(s("input",{type:"color","onUpdate:modelValue":e[5]||(e[5]=l=>L.value.d=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[te,L.value.d]])]),s("div",yt,[e[24]||(e[24]=s("span",{style:{"font-size":"12px"}},"e (Error)",-1)),ee(s("input",{type:"color","onUpdate:modelValue":e[6]||(e[6]=l=>L.value.e=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[te,L.value.e]])])])]),_:1})]),s("main",ht,[s("div",_t,[s("div",xt,[s("span",bt,o(be.value),1),u(q,{color:"#2db7f5"},{default:n(()=>[i(o(g.value.length)+" Events",1)]),_:1})]),u(S,{size:"small",onClick:je,title:"Download filtered logs as CSV"},{icon:n(()=>[...e[26]||(e[26]=[i("ðŸ“¥",-1)])]),default:n(()=>[e[27]||(e[27]=i(" Export CSV ",-1))]),_:1})]),e[32]||(e[32]=Re('<div class="log-row header-row"><div class="col-time">Time</div><div class="col-status">Status</div><div class="col-method">Method</div><div class="col-path">Path / Query</div><div class="col-meta">Client</div></div>',1)),s("div",{class:"log-list",ref_key:"listRef",ref:y,onScroll:Se},[s("div",{style:D({height:`${Ce.value}px`,position:"relative"})},[s("div",{style:D({transform:`translateY(${Le.value}px)`})},[(r(!0),f(H,null,X(ke.value,l=>(r(),f("div",{key:l.id,class:"log-row",onClick:U=>re(l)},[s("div",{class:"col-time",title:l.time},o(l.timeOnly),9,kt),s("div",{class:_e(["col-status status-badge",de(l.status)])},o(l.status),3),s("div",{class:"col-method",style:D({color:ue(l.method)})},o(l.method),5),s("div",{class:"col-path",style:D(ie(l))},[s("div",Ct,[l.device_id?(r(),M(q,{key:0,size:"small",color:"blue",style:{"margin-right":"4px","font-size":"10px",cursor:"pointer"},onClick:U=>{z.value=l.device_id,j()}},{default:n(()=>[i(o(l.device_id),1)]),_:2},1032,["onClick"])):_("",!0),l.path?(r(),f(H,{key:1},[l.tag?(r(),f(H,{key:0},[s("span",{style:{background:"var(--tag-bg)",padding:"0 4px","border-radius":"3px","margin-right":"4px","font-weight":"600",cursor:"pointer"},onClick:A(U=>{I.value=l.tag,j()},["stop"])},o(l.tag),9,Lt),s("span",{style:{"font-weight":"500"},innerHTML:Q(O(l).text||G(l.path))},null,8,St)],64)):O(l)?(r(),f(H,{key:1},[O(l).tag?(r(),f("span",{key:0,style:{background:"var(--tag-bg)",padding:"0 4px","border-radius":"3px","margin-right":"4px","font-weight":"600",cursor:"pointer"},onClick:A(U=>{I.value=O(l).tag,j()},["stop"])},o(O(l).tag),9,Tt)):_("",!0),s("span",{style:{"font-weight":"500"},innerHTML:Q(O(l).text||G(l.path))},null,8,It)],64)):(r(),f("span",{key:2,title:l.path,innerHTML:Q(G(l.path))},null,8,Dt)),ce(l)&&!O(l)&&!l.tag?(r(),f("span",{key:3,class:"query-string",style:D(ie(l))},"?"+o(ce(l)),5)):_("",!0)],64)):(r(),f("span",zt,o(l.raw),1))]),s("div",Ot,[l.body&&l.body!=="-"?(r(),M(He,{key:0,placement:"bottom",title:"Request Body",trigger:"hover"},{content:n(()=>[s("div",{class:"popover-json",style:D({color:C.value?"#e2e8f0":"#333"})},o(l.body),5)]),default:n(()=>[u(q,{color:"orange",style:{"margin-left":"8px",cursor:"pointer","border-radius":"2px"},title:"Click to Inspect Body"},{default:n(()=>[...e[28]||(e[28]=[i("BODY",-1)])]),_:1})]),_:2},1024)):_("",!0)])],4),s("div",qt,[s("div",Et,[u(S,{type:"text",size:"small",onClick:A(U=>ze(l),["stop"]),title:"Copy Log"},{icon:n(()=>[...e[29]||(e[29]=[i("ðŸ“‹",-1)])]),_:1},8,["onClick"]),u(S,{type:"text",size:"small",onClick:A(U=>re(l),["stop"]),title:"View Details"},{icon:n(()=>[...e[30]||(e[30]=[i("ðŸ”",-1)])]),_:1},8,["onClick"])]),l.os?(r(),M(ye,{key:0,title:l.ua},{default:n(()=>[u(q,{bordered:!1,class:"meta-tag"},{default:n(()=>[i(o(l.os),1)]),_:2},1024)]),_:2},1032,["title"])):_("",!0),l.device==="Mobile"?(r(),M(ye,{key:1,title:"Mobile Device"},{default:n(()=>[...e[31]||(e[31]=[s("span",null,"ðŸ“±",-1)])]),_:1})):_("",!0)])],8,wt))),128))],4)],4)],544)]),u(Ue,{open:J.value,"onUpdate:open":e[7]||(e[7]=l=>J.value=l),title:"Log Entry Details",placement:"right",width:"600",closable:!0,"body-style":{padding:"0"}},{default:n(()=>[d.value?(r(),f("div",Mt,[s("div",Pt,[e[38]||(e[38]=s("h3",null,"Basic Info",-1)),s("div",jt,[s("div",Ht,[e[33]||(e[33]=s("span",null,"ID",-1)),s("strong",null,o(d.value.id),1)]),s("div",Ut,[e[34]||(e[34]=s("span",null,"Time",-1)),s("strong",null,o(d.value.time),1)]),s("div",Vt,[e[35]||(e[35]=s("span",null,"Status",-1)),s("strong",{class:_e(de(d.value.status))},o(d.value.status),3)]),s("div",$t,[e[36]||(e[36]=s("span",null,"Method",-1)),s("strong",{style:D({color:ue(d.value.method)})},o(d.value.method),5)]),s("div",Rt,[e[37]||(e[37]=s("span",null,"IP Address",-1)),s("strong",null,o(d.value.ip),1)])])]),s("div",Bt,[e[42]||(e[42]=s("h3",null,"Request",-1)),s("div",At,[e[39]||(e[39]=s("span",null,"Path",-1)),s("code",Nt,o(d.value.path),1)]),d.value.query?(r(),f("div",Ft,[e[40]||(e[40]=s("span",null,"Query",-1)),s("code",Jt,o(d.value.query),1)])):_("",!0),d.value.body?(r(),f("div",Wt,[e[41]||(e[41]=s("span",null,"Body",-1)),s("code",Qt,o(d.value.body),1)])):_("",!0)]),s("div",Yt,[e[49]||(e[49]=s("h3",null,"Client Details",-1)),s("div",Gt,[s("div",Kt,[e[43]||(e[43]=s("span",null,"Device ID",-1)),u(q,{color:"blue"},{default:n(()=>[i(o(d.value.device_id||"N/A"),1)]),_:1})]),s("div",Xt,[e[44]||(e[44]=s("span",null,"Level",-1)),u(q,{color:De(d.value.level)},{default:n(()=>[i(o(d.value.level||"info"),1)]),_:1},8,["color"])]),s("div",Zt,[e[45]||(e[45]=s("span",null,"Tag",-1)),d.value.tag?(r(),M(q,{key:0},{default:n(()=>[i(o(d.value.tag),1)]),_:1})):_("",!0)]),s("div",es,[e[46]||(e[46]=s("span",null,"Browser",-1)),s("strong",null,o(d.value.browser),1)]),s("div",ts,[e[47]||(e[47]=s("span",null,"OS",-1)),s("strong",null,o(d.value.os),1)])]),s("div",ss,[e[48]||(e[48]=s("span",null,"User Agent",-1)),s("div",ls,o(d.value.ua),1)])]),s("div",ns,[e[50]||(e[50]=s("h3",null,"Raw Content",-1)),s("pre",os,o(d.value.raw),1)])])):_("",!0)]),_:1},8,["open"])])}}},is=Be(as);is.mount("#app");
