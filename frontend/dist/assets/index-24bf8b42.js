import{x as v,w as he,k as O,o as Ae,e as Be,ac as c,ad as f,ae as s,l as r,af as n,ag as a,ah as Ne,ai as I,F as A,aj as Q,E as B,X as i,ak as P,al as L,J as K,am as X,V as Z,an as xe,ao as He}from"./vendor-aa91f45f.js";import{A as Fe,I as Je,_ as We,B as Ye,C as Ge,a as Qe,b as Ke,S as Xe,c as Ze,d as et,e as tt}from"./vendor-antd-9d62bf7e.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))T(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const w of p.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&T(w)}).observe(document,{childList:!0,subtree:!0});function b(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function T(d){if(d.ep)return;d.ep=!0;const p=b(d);fetch(d.href,p)}})();const st={id:"app-container"},lt={class:"sidebar"},ot={class:"brand"},nt={class:"filter-section"},at={class:"search-wrapper"},it={class:"select-group"},rt={class:"sub-filters"},ut={style:{display:"flex",gap:"8px"}},dt={key:0},ct={key:1},vt={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"12px"}},pt={style:{"margin-top":"8px",display:"flex","justify-content":"space-between","font-size":"12px",color:"var(--text-secondary)"}},ft={style:{"margin-top":"4px","font-size":"12px",color:"var(--text-secondary)",display:"flex","align-items":"center",gap:"6px"}},mt={key:0,class:"pulse-dot"},gt={style:{display:"flex","flex-direction":"column",gap:"8px"}},yt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},_t={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ht={style:{display:"flex","align-items":"center","justify-content":"space-between"}},xt={class:"main"},bt={class:"navbar"},wt={style:{display:"flex","align-items":"center",gap:"12px"}},kt={style:{"font-weight":"600","font-size":"13px"}},Ct=["onClick"],St=["title"],Lt={class:"col-level"},Tt={class:"col-tag"},It=["onClick"],Dt={key:1},zt={class:"path-container"},Ot=["innerHTML"],qt={key:1,style:{color:"var(--text-secondary)",opacity:"0.7","font-style":"italic"}},Et={class:"body-container"},Pt={class:"col-meta"},jt={class:"row-actions"},Ut={key:0,class:"detail-content"},Mt={class:"detail-section"},Vt={class:"detail-grid"},$t={class:"grid-item"},Rt={class:"grid-item"},At={class:"grid-item"},Bt={class:"grid-item"},Nt={class:"grid-item"},Ht={class:"detail-section"},Ft={class:"grid-item full"},Jt={class:"code-block"},Wt={key:0,class:"grid-item full"},Yt={class:"code-block"},Gt={key:1,class:"grid-item full"},Qt={class:"code-block"},Kt={class:"detail-section"},Xt={class:"detail-grid"},Zt={class:"grid-item"},es={class:"grid-item"},ts={class:"grid-item"},ss={class:"grid-item"},ls={class:"grid-item"},os={class:"grid-item full",style:{"margin-top":"12px"}},ns={class:"ua-text"},as={class:"detail-section"},is={class:"raw-pre"},j=48,ee=2e3,rs={__name:"App",setup(be){const m=v([]),b=v([]),T=v([]),d=v(""),p=v(!1),w=v(!1),N=v({pv:0,uv:0}),_=v(null),we=v("access.log"),k=v(localStorage.getItem("theme")!=="light"),H=v(!1),u=v(null),te=v([]),se=v([]),q=v(void 0),E=v(void 0),D=v(void 0),C=v(JSON.parse(localStorage.getItem("levelColors"))||{v:k.value?"#cccccc":"#000000",d:"#007acc",e:"#f44747"});he(C,t=>{localStorage.setItem("levelColors",JSON.stringify(t))},{deep:!0});const le=v(0),oe=v(800),F=v(!0),ke=O(()=>Math.ceil(oe.value/j)+5),J=O(()=>Math.floor(le.value/j)),Ce=O(()=>W.value.slice(J.value,J.value+ke.value)),Se=O(()=>W.value.length*j),Le=O(()=>J.value*j),Te=t=>{le.value=t.target.scrollTop,F.value=t.target.scrollTop<10},U=()=>{_.value&&(oe.value=_.value.clientHeight)},M=()=>{ge(),Y()};let V=null;const Ie=()=>{if(T.value.length===0)return;const t=[...T.value].reverse(),e=t.length,o=[...t,...m.value];if(T.value=[],o.length>ee?m.value=o.slice(0,ee):m.value=o,F.value)B(()=>{_.value&&(_.value.scrollTop=0)});else{const y=e*j;B(()=>{_.value&&(_.value.scrollTop+=y)})}},De=t=>{if(t.level)return t.level;if(!t.query&&!t.path)return null;let e="";if(t.query&&t.query!=="-"?e=t.query:t.path&&t.path.includes("?")&&(e=t.path.split("?")[1]),!e)return null;const o=e.split("&");for(const y of o)if(y.startsWith("level="))return y.substring(6);return null},ne=t=>{if(t.tag||t.level)return{tag:t.tag,text:t.query||t.path};if(!t.path||!t.path.startsWith("/log/"))return null;const e=t.query||(t.path.includes("?")?t.path.split("?")[1]:"");if(!e)return null;const o=new URLSearchParams(e);return{tag:o.get("tag"),text:o.get("text")}},ae=t=>{const e=De(t);return e&&C.value[e]?{color:C.value[e],fontWeight:e==="e"?"600":"normal"}:{}},ze=t=>{if(!d.value||!t)return t;const e=d.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`(${e})`,"gi");return String(t).replace(o,'<mark class="hl">$1</mark>')},ie=t=>t==="e"||t==="error"?"red":t==="d"||t==="debug"?"blue":"default",re=t=>{u.value=t,H.value=!0},Oe=t=>{const e=JSON.stringify(t,null,2);navigator.clipboard.writeText(e).then(()=>{})},qe=t=>{t.timeOnly=ve(t.time);const e=Object.freeze(t);if(p.value){b.value.unshift(e);return}T.value.push(e),V||(V=setInterval(Ie,100))},W=O(()=>{let t=m.value;if(q.value&&(t=t.filter(o=>o.device_id===q.value)),E.value&&(t=t.filter(o=>o.level===E.value)),D.value&&(t=t.filter(o=>o.tag===D.value)),!d.value)return t;const e=d.value.toLowerCase();return t.filter(o=>o.path&&o.path.toLowerCase().includes(e)||o.ip&&o.ip.includes(e)||o.device_id&&o.device_id.toLowerCase().includes(e)||o.tag&&o.tag.toLowerCase().includes(e)||o.status&&String(o.status).includes(e))}),Ee=O(()=>k.value?"#cccccc":"#333333"),Pe=()=>{k.value=!k.value,localStorage.setItem("theme",k.value?"dark":"light")};he(k,t=>{document.documentElement.setAttribute("data-theme",t?"dark":"light")},{immediate:!0});const ue=t=>{const e={GET:"#4ec9b0",POST:"#569cd6",PUT:"#dcdcaa",DELETE:"#f44747"};return k.value?e[t]||"#cccccc":{GET:"#059669",POST:"#2563eb",PUT:"#d97706",DELETE:"#dc2626"}[t]||"#666"},de=t=>t<300?"c-2xx":t<400?"c-3xx":t<500?"c-4xx":"c-5xx",je=t=>t?t.split("?")[0]:"",ce=t=>{let e="";if(t.query&&t.query!=="-"?(e=t.query,e.startsWith("?")&&(e=e.substring(1))):t.path&&t.path.includes("?")&&(e=t.path.split("?")[1]),!e)return"";try{return decodeURIComponent(e)}catch{return e}},ve=t=>{if(!t)return"--:--:--";if(t.includes("T"))return t.split("T")[1].split(".")[0];const e=t.split(":");return e.length>=4?e.slice(1,4).join(":").split(" ")[0]:t};let $=null;const pe=()=>{const t=window.location.protocol==="https:"?"wss":"ws",e=window.location.host;$=new WebSocket(`${t}://${e}/ws`),$.onopen=()=>w.value=!0,$.onclose=()=>{w.value=!1,setTimeout(pe,2e3)},$.onmessage=o=>{try{qe(JSON.parse(o.data))}catch{}}},Ue=async()=>{try{N.value=await(await fetch("/api/stats")).json()}catch{}},fe=async()=>{try{te.value=await(await fetch("/api/devices")).json()}catch{}},me=async()=>{try{se.value=await(await fetch("/api/tags")).json()}catch{}},Y=async()=>{try{const t=new URLSearchParams;q.value&&t.set("device",q.value),E.value&&t.set("level",E.value),D.value&&t.set("tag",D.value);const e=`/api/history?${t.toString()}`,y=await(await fetch(e)).json();y&&(m.value=y.map(h=>({...h,timeOnly:ve(h.time),id:h.id||Math.random()})).map(Object.freeze),B(()=>{U(),_.value&&(_.value.scrollTop=0)}))}catch{}},Me=()=>{p.value=!p.value,p.value||(b.value.length>0&&(m.value=[...b.value,...m.value].slice(0,ee),b.value=[]),B(()=>{_.value&&F.value&&(_.value.scrollTop=0)}))},ge=()=>{m.value=[],b.value=[],T.value=[]},Ve=()=>{const t=W.value;if(!t.length)return;const e=["ID","Time","Level","Tag","DeviceID","Method","Path","Status","IP"],o=t.map(g=>[g.id,g.time,g.level||"info",g.tag||"",g.device_id||"",g.method,g.path,g.status,g.ip]),y=[e.join(","),...o.map(g=>g.map(R=>`"${String(R).replace(/"/g,'""')}"`).join(","))].join(`
`),h=new Blob([y],{type:"text/csv;charset=utf-8;"}),x=document.createElement("a"),S=URL.createObjectURL(h);x.setAttribute("href",S),x.setAttribute("download",`logs_export_${new Date().getTime()}.csv`),x.style.visibility="hidden",document.body.appendChild(x),x.click(),document.body.removeChild(x)};return Ae(()=>{pe(),Y(),fe(),me(),setInterval(Ue,5e3),setInterval(fe,1e4),setInterval(me,15e3),U(),window.addEventListener("resize",U)}),Be(()=>{V&&clearInterval(V),window.removeEventListener("resize",U)}),(t,e)=>{const o=Fe,y=Je,h=Xe,x=We,S=Ye,g=Ze,R=Ge,z=Qe,$e=et,ye=tt,Re=Ke;return c(),f("div",st,[s("aside",lt,[s("div",ot,[r(o,{size:32,shape:"square"},{default:n(()=>[...e[8]||(e[8]=[i("SS",-1)])]),_:1}),e[9]||(e[9]=s("span",null,"Sonic Stellar",-1))]),s("div",nt,[s("div",at,[r(y,{value:d.value,"onUpdate:value":e[0]||(e[0]=l=>d.value=l),placeholder:"Search logs...","allow-clear":"",class:"modern-search"},{prefix:n(()=>[...e[10]||(e[10]=[i("ðŸ”",-1)])]),_:1},8,["value"])]),s("div",it,[r(x,{value:q.value,"onUpdate:value":e[1]||(e[1]=l=>q.value=l),placeholder:"Device","show-search":"","allow-clear":"",onChange:M,class:"modern-select"},{suffixIcon:n(()=>[...e[11]||(e[11]=[i("ðŸ“±",-1)])]),default:n(()=>[(c(!0),f(A,null,Q(te.value,l=>(c(),P(h,{key:l,value:l},{default:n(()=>[i(a(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",rt,[r(x,{value:E.value,"onUpdate:value":e[2]||(e[2]=l=>E.value=l),placeholder:"Level","allow-clear":"",onChange:M,class:"modern-select level-select"},{suffixIcon:n(()=>[...e[12]||(e[12]=[i("ðŸ“Š",-1)])]),default:n(()=>[r(h,{value:"v"},{default:n(()=>[...e[13]||(e[13]=[i("Verbose",-1)])]),_:1}),r(h,{value:"d"},{default:n(()=>[...e[14]||(e[14]=[i("Debug",-1)])]),_:1}),r(h,{value:"e"},{default:n(()=>[...e[15]||(e[15]=[i("Error",-1)])]),_:1})]),_:1},8,["value"]),r(x,{value:D.value,"onUpdate:value":e[3]||(e[3]=l=>D.value=l),placeholder:"Tag","show-search":"","allow-clear":"",onChange:M,class:"modern-select tag-select"},{suffixIcon:n(()=>[...e[16]||(e[16]=[i("ðŸ·ï¸",-1)])]),default:n(()=>[(c(!0),f(A,null,Q(se.value,l=>(c(),P(h,{key:l,value:l},{default:n(()=>[i(a(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),s("div",ut,[r(S,{type:"primary",danger:p.value,onClick:Me,block:"",ghost:""},{icon:n(()=>[p.value?(c(),f("span",ct,"â–¶ï¸")):(c(),f("span",dt,"â¸"))]),default:n(()=>[i(" "+a(p.value?b.value.length>0?`Resume (${b.value.length})`:"Resume":"Pause"),1)]),_:1},8,["danger"]),r(S,{onClick:ge,block:""},{default:n(()=>[...e[17]||(e[17]=[i(" ðŸ—‘ Clear ",-1)])]),_:1})]),r(R,{size:"small",bordered:!1,style:{background:"var(--card-bg)","margin-top":"auto"}},{default:n(()=>[s("div",vt,[e[18]||(e[18]=s("span",{style:{"font-size":"12px","font-weight":"600",color:"var(--text-secondary)"}},"STATISTICS",-1)),r(S,{type:"text",size:"small",onClick:Pe},{default:n(()=>[i(a(k.value?"ðŸŒ™":"â˜€ï¸"),1)]),_:1})]),r(g,{title:"Total Requests",value:N.value.pv,"value-style":{color:Ee.value}},null,8,["value","value-style"]),s("div",pt,[e[19]||(e[19]=s("span",null,"Unique Visitors",-1)),s("span",null,a(N.value.uv),1)]),s("div",ft,[e[20]||(e[20]=i(" Status: ",-1)),s("span",{style:I({color:w.value?"#4ec9b0":"#f44747"})},a(w.value?"Live":"Offline"),5),w.value?(c(),f("div",mt)):L("",!0)]),r(S,{size:"small",type:"link",onClick:Y,style:{padding:"0","margin-top":"8px"}},{default:n(()=>[...e[21]||(e[21]=[i("Load History",-1)])]),_:1})]),_:1}),r(R,{size:"small",bordered:!1,style:{background:"var(--card-bg)","margin-top":"12px"}},{default:n(()=>[e[25]||(e[25]=s("div",{style:{"font-size":"11px","font-weight":"600",color:"var(--text-secondary)","margin-bottom":"8px"}},"LEVEL COLORS ",-1)),s("div",gt,[s("div",yt,[e[22]||(e[22]=s("span",{style:{"font-size":"12px"}},"v (Verbose)",-1)),K(s("input",{type:"color","onUpdate:modelValue":e[4]||(e[4]=l=>C.value.v=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[X,C.value.v]])]),s("div",_t,[e[23]||(e[23]=s("span",{style:{"font-size":"12px"}},"d (Debug)",-1)),K(s("input",{type:"color","onUpdate:modelValue":e[5]||(e[5]=l=>C.value.d=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[X,C.value.d]])]),s("div",ht,[e[24]||(e[24]=s("span",{style:{"font-size":"12px"}},"e (Error)",-1)),K(s("input",{type:"color","onUpdate:modelValue":e[6]||(e[6]=l=>C.value.e=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[X,C.value.e]])])])]),_:1})]),s("main",xt,[s("div",bt,[s("div",wt,[s("span",kt,a(we.value),1),r(z,{color:"#2db7f5"},{default:n(()=>[i(a(m.value.length)+" Events",1)]),_:1})]),r(S,{size:"small",onClick:Ve,title:"Download filtered logs as CSV"},{icon:n(()=>[...e[26]||(e[26]=[i("ðŸ“¥",-1)])]),default:n(()=>[e[27]||(e[27]=i(" Export CSV ",-1))]),_:1})]),e[32]||(e[32]=Ne('<div class="log-row header-row"><div class="col-time">Time</div><div class="col-level">Lvl</div><div class="col-tag">Tag</div><div class="col-status">Status</div><div class="col-method">Mthd</div><div class="col-path">Path / Content</div><div class="col-meta">Client</div></div>',1)),s("div",{class:"log-list",ref_key:"listRef",ref:_,onScroll:Te},[s("div",{style:I({height:`${Se.value}px`,position:"relative"})},[s("div",{style:I({transform:`translateY(${Le.value}px)`})},[(c(!0),f(A,null,Q(Ce.value,l=>{var _e;return c(),f("div",{key:l.id,class:"log-row",onClick:G=>re(l)},[s("div",{class:"col-time",title:l.time},a(l.timeOnly),9,St),s("div",Lt,[r(z,{color:ie(l.level),style:{"font-size":"10px","min-width":"45px","text-align":"center",margin:"0"}},{default:n(()=>[i(a((l.level||"info").toUpperCase()),1)]),_:2},1032,["color"])]),s("div",Tt,[l.tag?(c(),f("span",{key:0,class:"small-badge",onClick:Z(G=>{D.value=l.tag,M()},["stop"])},a(l.tag),9,It)):(c(),f("span",Dt,"-"))]),s("div",{class:xe(["col-status status-badge",de(l.status)])},a(l.status),3),s("div",{class:"col-method",style:I({color:ue(l.method)})},a(l.method),5),s("div",{class:"col-path",style:I(ae(l))},[s("div",zt,[l.path?(c(),f(A,{key:0},[s("span",{style:{"font-weight":"500"},innerHTML:ze(((_e=ne(l))==null?void 0:_e.text)||je(l.path))},null,8,Ot),ce(l)&&!ne(l)?(c(),f("span",{key:0,class:"query-string",style:I(ae(l))},"?"+a(ce(l)),5)):L("",!0)],64)):(c(),f("span",qt,a(l.raw),1))]),s("div",Et,[l.body&&l.body!=="-"?(c(),P($e,{key:0,placement:"bottom",title:"Request Body",trigger:"hover"},{content:n(()=>[s("div",{class:"popover-json",style:I({color:k.value?"#e2e8f0":"#333"})},a(l.body),5)]),default:n(()=>[r(z,{color:"orange",style:{"margin-left":"8px",cursor:"pointer","border-radius":"2px"},title:"Click to Inspect Body"},{default:n(()=>[...e[28]||(e[28]=[i("BODY",-1)])]),_:1})]),_:2},1024)):L("",!0)])],4),s("div",Pt,[s("div",jt,[r(S,{type:"text",size:"small",onClick:Z(G=>Oe(l),["stop"]),title:"Copy Log"},{icon:n(()=>[...e[29]||(e[29]=[i("ðŸ“‹",-1)])]),_:1},8,["onClick"]),r(S,{type:"text",size:"small",onClick:Z(G=>re(l),["stop"]),title:"View Details"},{icon:n(()=>[...e[30]||(e[30]=[i("ðŸ”",-1)])]),_:1},8,["onClick"])]),l.os?(c(),P(ye,{key:0,title:l.ua},{default:n(()=>[r(z,{bordered:!1,class:"meta-tag"},{default:n(()=>[i(a(l.os),1)]),_:2},1024)]),_:2},1032,["title"])):L("",!0),l.device==="Mobile"?(c(),P(ye,{key:1,title:"Mobile Device"},{default:n(()=>[...e[31]||(e[31]=[s("span",null,"ðŸ“±",-1)])]),_:1})):L("",!0)])],8,Ct)}),128))],4)],4)],544)]),r(Re,{open:H.value,"onUpdate:open":e[7]||(e[7]=l=>H.value=l),title:"Log Entry Details",placement:"right",width:"600",closable:!0,"body-style":{padding:"0"}},{default:n(()=>[u.value?(c(),f("div",Ut,[s("div",Mt,[e[38]||(e[38]=s("h3",null,"Basic Info",-1)),s("div",Vt,[s("div",$t,[e[33]||(e[33]=s("span",null,"ID",-1)),s("strong",null,a(u.value.id),1)]),s("div",Rt,[e[34]||(e[34]=s("span",null,"Time",-1)),s("strong",null,a(u.value.time),1)]),s("div",At,[e[35]||(e[35]=s("span",null,"Status",-1)),s("strong",{class:xe(de(u.value.status))},a(u.value.status),3)]),s("div",Bt,[e[36]||(e[36]=s("span",null,"Method",-1)),s("strong",{style:I({color:ue(u.value.method)})},a(u.value.method),5)]),s("div",Nt,[e[37]||(e[37]=s("span",null,"IP Address",-1)),s("strong",null,a(u.value.ip),1)])])]),s("div",Ht,[e[42]||(e[42]=s("h3",null,"Request",-1)),s("div",Ft,[e[39]||(e[39]=s("span",null,"Path",-1)),s("code",Jt,a(u.value.path),1)]),u.value.query?(c(),f("div",Wt,[e[40]||(e[40]=s("span",null,"Query",-1)),s("code",Yt,a(u.value.query),1)])):L("",!0),u.value.body?(c(),f("div",Gt,[e[41]||(e[41]=s("span",null,"Body",-1)),s("code",Qt,a(u.value.body),1)])):L("",!0)]),s("div",Kt,[e[49]||(e[49]=s("h3",null,"Client Details",-1)),s("div",Xt,[s("div",Zt,[e[43]||(e[43]=s("span",null,"Device ID",-1)),r(z,{color:"blue"},{default:n(()=>[i(a(u.value.device_id||"N/A"),1)]),_:1})]),s("div",es,[e[44]||(e[44]=s("span",null,"Level",-1)),r(z,{color:ie(u.value.level)},{default:n(()=>[i(a(u.value.level||"info"),1)]),_:1},8,["color"])]),s("div",ts,[e[45]||(e[45]=s("span",null,"Tag",-1)),u.value.tag?(c(),P(z,{key:0},{default:n(()=>[i(a(u.value.tag),1)]),_:1})):L("",!0)]),s("div",ss,[e[46]||(e[46]=s("span",null,"Browser",-1)),s("strong",null,a(u.value.browser),1)]),s("div",ls,[e[47]||(e[47]=s("span",null,"OS",-1)),s("strong",null,a(u.value.os),1)])]),s("div",os,[e[48]||(e[48]=s("span",null,"User Agent",-1)),s("div",ns,a(u.value.ua),1)])]),s("div",as,[e[50]||(e[50]=s("h3",null,"Raw Content",-1)),s("pre",is,a(u.value.raw),1)])])):L("",!0)]),_:1},8,["open"])])}}},us=He(rs);us.mount("#app");
