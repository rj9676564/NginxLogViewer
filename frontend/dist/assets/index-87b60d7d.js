import{x as v,w as he,k as q,o as Be,e as Ne,ac as d,ad as f,ae as s,l as r,af as o,ag as a,ah as He,ai as D,F as B,aj as X,E as N,X as i,ak as E,al as b,J as Z,am as ee,V as H,an as xe,ao as Fe}from"./vendor-aa91f45f.js";import{A as Je,I as We,_ as Ye,B as Ge,C as Qe,a as Ke,b as Xe,S as Ze,c as et,d as tt,e as st}from"./vendor-antd-9d62bf7e.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))T(c);new MutationObserver(c=>{for(const p of c)if(p.type==="childList")for(const k of p.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&T(k)}).observe(document,{childList:!0,subtree:!0});function w(c){const p={};return c.integrity&&(p.integrity=c.integrity),c.referrerPolicy&&(p.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?p.credentials="include":c.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function T(c){if(c.ep)return;c.ep=!0;const p=w(c);fetch(c.href,p)}})();const lt={id:"app-container"},ot={class:"sidebar"},nt={class:"brand"},at={class:"filter-section"},it={class:"search-wrapper"},rt={class:"select-group"},ut={class:"sub-filters"},dt={style:{display:"flex",gap:"8px"}},ct={key:0},vt={key:1},pt={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"12px"}},ft={style:{"margin-top":"8px",display:"flex","justify-content":"space-between","font-size":"12px",color:"var(--text-secondary)"}},mt={style:{"margin-top":"4px","font-size":"12px",color:"var(--text-secondary)",display:"flex","align-items":"center",gap:"6px"}},gt={key:0,class:"pulse-dot"},yt={style:{display:"flex","flex-direction":"column",gap:"8px"}},_t={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ht={style:{display:"flex","align-items":"center","justify-content":"space-between"}},xt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},bt={class:"main"},wt={class:"navbar"},kt={style:{display:"flex","align-items":"center",gap:"12px"}},Ct={style:{"font-weight":"600","font-size":"13px"}},St=["onClick"],Lt=["title"],Tt={class:"col-level"},It={class:"col-tag"},Dt=["onClick"],zt={key:1},Ot={class:"path-container"},qt=["innerHTML"],Et={key:1,style:{color:"var(--text-secondary)",opacity:"0.7","font-style":"italic"}},Pt={class:"body-container"},Ut={class:"col-meta"},jt={class:"row-actions"},Mt={key:0,class:"detail-content"},Vt={class:"detail-section"},$t={class:"detail-grid"},Rt={class:"grid-item"},At={class:"grid-item"},Bt={class:"grid-item"},Nt={class:"grid-item"},Ht={class:"grid-item"},Ft={class:"detail-section"},Jt={class:"grid-item full"},Wt={class:"code-block"},Yt={key:0,class:"grid-item full"},Gt={class:"code-block"},Qt={key:1,class:"grid-item full"},Kt={class:"code-block"},Xt={class:"detail-section"},Zt={class:"detail-grid"},es={class:"grid-item"},ts={class:"grid-item"},ss={class:"grid-item"},ls={class:"grid-item"},os={class:"grid-item"},ns={class:"grid-item full",style:{"margin-top":"12px"}},as={class:"ua-text"},is={class:"detail-section"},rs={class:"raw-pre"},j=48,te=2e3,us={__name:"App",setup(be){const m=v([]),w=v([]),T=v([]),c=v(""),p=v(!1),k=v(!1),F=v({pv:0,uv:0}),_=v(null),we=v("access.log"),C=v(localStorage.getItem("theme")!=="light"),J=v(!1),u=v(null),se=v([]),le=v([]),z=v(void 0),P=v(void 0),O=v(void 0),S=v(JSON.parse(localStorage.getItem("levelColors"))||{v:C.value?"#cccccc":"#000000",d:"#007acc",e:"#f44747"});he(S,t=>{localStorage.setItem("levelColors",JSON.stringify(t))},{deep:!0});const oe=v(0),ne=v(800),W=v(!0),ke=q(()=>Math.ceil(ne.value/j)+5),Y=q(()=>Math.floor(oe.value/j)),Ce=q(()=>G.value.slice(Y.value,Y.value+ke.value)),Se=q(()=>G.value.length*j),Le=q(()=>Y.value*j),Te=t=>{oe.value=t.target.scrollTop,W.value=t.target.scrollTop<10},M=()=>{_.value&&(ne.value=_.value.clientHeight)},U=()=>{ye(),Q()};let V=null;const Ie=()=>{if(T.value.length===0)return;const t=[...T.value].reverse(),e=t.length,n=[...t,...m.value];if(T.value=[],n.length>te?m.value=n.slice(0,te):m.value=n,W.value)N(()=>{_.value&&(_.value.scrollTop=0)});else{const y=e*j;N(()=>{_.value&&(_.value.scrollTop+=y)})}},De=t=>{if(t.level)return t.level;if(!t.query&&!t.path)return null;let e="";if(t.query&&t.query!=="-"?e=t.query:t.path&&t.path.includes("?")&&(e=t.path.split("?")[1]),!e)return null;const n=e.split("&");for(const y of n)if(y.startsWith("level="))return y.substring(6);return null},ae=t=>{if(t.tag||t.level)return{tag:t.tag,text:t.query||t.path};if(!t.path||!t.path.startsWith("/log/"))return null;const e=t.query||(t.path.includes("?")?t.path.split("?")[1]:"");if(!e)return null;const n=new URLSearchParams(e);return{tag:n.get("tag"),text:n.get("text")}},ie=t=>{const e=De(t);return e&&S.value[e]?{color:S.value[e],fontWeight:e==="e"?"600":"normal"}:{}},ze=t=>{if(!c.value||!t)return t;const e=c.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`(${e})`,"gi");return String(t).replace(n,'<mark class="hl">$1</mark>')},re=t=>t==="e"||t==="error"?"red":t==="d"||t==="debug"?"blue":"default",ue=t=>{u.value=t,J.value=!0},Oe=t=>{const e=JSON.stringify(t,null,2);navigator.clipboard.writeText(e).then(()=>{})},qe=t=>{t.timeOnly=pe(t.time);const e=Object.freeze(t);if(p.value){w.value.unshift(e);return}T.value.push(e),V||(V=setInterval(Ie,100))},G=q(()=>{let t=m.value;if(z.value&&(t=t.filter(n=>n.device_id===z.value)),P.value&&(t=t.filter(n=>n.level===P.value)),O.value&&(t=t.filter(n=>n.tag===O.value)),!c.value)return t;const e=c.value.toLowerCase();return t.filter(n=>n.path&&n.path.toLowerCase().includes(e)||n.ip&&n.ip.includes(e)||n.device_id&&n.device_id.toLowerCase().includes(e)||n.tag&&n.tag.toLowerCase().includes(e)||n.status&&String(n.status).includes(e))}),Ee=q(()=>C.value?"#cccccc":"#333333"),Pe=()=>{C.value=!C.value,localStorage.setItem("theme",C.value?"dark":"light")};he(C,t=>{document.documentElement.setAttribute("data-theme",t?"dark":"light")},{immediate:!0});const de=t=>{const e={GET:"#4ec9b0",POST:"#569cd6",PUT:"#dcdcaa",DELETE:"#f44747"};return C.value?e[t]||"#cccccc":{GET:"#059669",POST:"#2563eb",PUT:"#d97706",DELETE:"#dc2626"}[t]||"#666"},ce=t=>t<300?"c-2xx":t<400?"c-3xx":t<500?"c-4xx":"c-5xx",Ue=t=>t?t.split("?")[0]:"",je=t=>!t||t==="unknow"?"Unknown":t.length<=6?t:t.substring(t.length-6),ve=t=>{let e="";if(t.query&&t.query!=="-"?(e=t.query,e.startsWith("?")&&(e=e.substring(1))):t.path&&t.path.includes("?")&&(e=t.path.split("?")[1]),!e)return"";try{return decodeURIComponent(e)}catch{return e}},pe=t=>{if(!t)return"--:--:--";if(t.includes("T"))return t.split("T")[1].split(".")[0];const e=t.split(":");return e.length>=4?e.slice(1,4).join(":").split(" ")[0]:t};let $=null;const fe=()=>{const t=window.location.protocol==="https:"?"wss":"ws",e=window.location.host;$=new WebSocket(`${t}://${e}/ws`),$.onopen=()=>k.value=!0,$.onclose=()=>{k.value=!1,setTimeout(fe,2e3)},$.onmessage=n=>{try{qe(JSON.parse(n.data))}catch{}}},Me=async()=>{try{F.value=await(await fetch("/api/stats")).json()}catch{}},me=async()=>{try{se.value=await(await fetch("/api/devices")).json()}catch{}},ge=async()=>{try{le.value=await(await fetch("/api/tags")).json()}catch{}},Q=async()=>{try{const t=new URLSearchParams;z.value&&t.set("device",z.value),P.value&&t.set("level",P.value),O.value&&t.set("tag",O.value);const e=`/api/history?${t.toString()}`,y=await(await fetch(e)).json();y&&(m.value=y.map(h=>({...h,timeOnly:pe(h.time),id:h.id||Math.random()})).map(Object.freeze),N(()=>{M(),_.value&&(_.value.scrollTop=0)}))}catch{}},Ve=()=>{p.value=!p.value,p.value||(w.value.length>0&&(m.value=[...w.value,...m.value].slice(0,te),w.value=[]),N(()=>{_.value&&W.value&&(_.value.scrollTop=0)}))},ye=()=>{m.value=[],w.value=[],T.value=[]},$e=()=>{const t=G.value;if(!t.length)return;const e=["ID","Time","Level","Tag","DeviceID","Method","Path","Status","IP"],n=t.map(g=>[g.id,g.time,g.level||"info",g.tag||"",g.device_id||"",g.method,g.path,g.status,g.ip]),y=[e.join(","),...n.map(g=>g.map(R=>`"${String(R).replace(/"/g,'""')}"`).join(","))].join(`
`),h=new Blob([y],{type:"text/csv;charset=utf-8;"}),x=document.createElement("a"),L=URL.createObjectURL(h);x.setAttribute("href",L),x.setAttribute("download",`logs_export_${new Date().getTime()}.csv`),x.style.visibility="hidden",document.body.appendChild(x),x.click(),document.body.removeChild(x)};return Be(()=>{fe(),Q(),me(),ge(),setInterval(Me,5e3),setInterval(me,1e4),setInterval(ge,15e3),M(),window.addEventListener("resize",M)}),Ne(()=>{V&&clearInterval(V),window.removeEventListener("resize",M)}),(t,e)=>{const n=Je,y=We,h=Ze,x=Ye,L=Ge,g=et,R=Qe,I=Ke,Re=tt,K=st,Ae=Xe;return d(),f("div",lt,[s("aside",ot,[s("div",nt,[r(n,{size:32,shape:"square"},{default:o(()=>[...e[8]||(e[8]=[i("SS",-1)])]),_:1}),e[9]||(e[9]=s("span",null,"Sonic Stellar",-1))]),s("div",at,[s("div",it,[r(y,{value:c.value,"onUpdate:value":e[0]||(e[0]=l=>c.value=l),placeholder:"Search logs...","allow-clear":"",class:"modern-search"},{prefix:o(()=>[...e[10]||(e[10]=[i("ðŸ”",-1)])]),_:1},8,["value"])]),s("div",rt,[r(x,{value:z.value,"onUpdate:value":e[1]||(e[1]=l=>z.value=l),placeholder:"Device","show-search":"","allow-clear":"",onChange:U,class:"modern-select"},{suffixIcon:o(()=>[...e[11]||(e[11]=[i("ðŸ“±",-1)])]),default:o(()=>[(d(!0),f(B,null,X(se.value,l=>(d(),E(h,{key:l,value:l},{default:o(()=>[i(a(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",ut,[r(x,{value:P.value,"onUpdate:value":e[2]||(e[2]=l=>P.value=l),placeholder:"Level","allow-clear":"",onChange:U,class:"modern-select level-select"},{suffixIcon:o(()=>[...e[12]||(e[12]=[i("ðŸ“Š",-1)])]),default:o(()=>[r(h,{value:"v"},{default:o(()=>[...e[13]||(e[13]=[i("Verbose",-1)])]),_:1}),r(h,{value:"d"},{default:o(()=>[...e[14]||(e[14]=[i("Debug",-1)])]),_:1}),r(h,{value:"e"},{default:o(()=>[...e[15]||(e[15]=[i("Error",-1)])]),_:1})]),_:1},8,["value"]),r(x,{value:O.value,"onUpdate:value":e[3]||(e[3]=l=>O.value=l),placeholder:"Tag","show-search":"","allow-clear":"",onChange:U,class:"modern-select tag-select"},{suffixIcon:o(()=>[...e[16]||(e[16]=[i("ðŸ·ï¸",-1)])]),default:o(()=>[(d(!0),f(B,null,X(le.value,l=>(d(),E(h,{key:l,value:l},{default:o(()=>[i(a(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),s("div",dt,[r(L,{type:"primary",danger:p.value,onClick:Ve,block:"",ghost:""},{icon:o(()=>[p.value?(d(),f("span",vt,"â–¶ï¸")):(d(),f("span",ct,"â¸"))]),default:o(()=>[i(" "+a(p.value?w.value.length>0?`Resume (${w.value.length})`:"Resume":"Pause"),1)]),_:1},8,["danger"]),r(L,{onClick:ye,block:""},{default:o(()=>[...e[17]||(e[17]=[i(" ðŸ—‘ Clear ",-1)])]),_:1})]),r(R,{size:"small",bordered:!1,style:{background:"var(--card-bg)","margin-top":"auto"}},{default:o(()=>[s("div",pt,[e[18]||(e[18]=s("span",{style:{"font-size":"12px","font-weight":"600",color:"var(--text-secondary)"}},"STATISTICS",-1)),r(L,{type:"text",size:"small",onClick:Pe},{default:o(()=>[i(a(C.value?"ðŸŒ™":"â˜€ï¸"),1)]),_:1})]),r(g,{title:"Total Requests",value:F.value.pv,"value-style":{color:Ee.value}},null,8,["value","value-style"]),s("div",ft,[e[19]||(e[19]=s("span",null,"Unique Visitors",-1)),s("span",null,a(F.value.uv),1)]),s("div",mt,[e[20]||(e[20]=i(" Status: ",-1)),s("span",{style:D({color:k.value?"#4ec9b0":"#f44747"})},a(k.value?"Live":"Offline"),5),k.value?(d(),f("div",gt)):b("",!0)]),r(L,{size:"small",type:"link",onClick:Q,style:{padding:"0","margin-top":"8px"}},{default:o(()=>[...e[21]||(e[21]=[i("Load History",-1)])]),_:1})]),_:1}),r(R,{size:"small",bordered:!1,style:{background:"var(--card-bg)","margin-top":"12px"}},{default:o(()=>[e[25]||(e[25]=s("div",{style:{"font-size":"11px","font-weight":"600",color:"var(--text-secondary)","margin-bottom":"8px"}},"LEVEL COLORS ",-1)),s("div",yt,[s("div",_t,[e[22]||(e[22]=s("span",{style:{"font-size":"12px"}},"v (Verbose)",-1)),Z(s("input",{type:"color","onUpdate:modelValue":e[4]||(e[4]=l=>S.value.v=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[ee,S.value.v]])]),s("div",ht,[e[23]||(e[23]=s("span",{style:{"font-size":"12px"}},"d (Debug)",-1)),Z(s("input",{type:"color","onUpdate:modelValue":e[5]||(e[5]=l=>S.value.d=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[ee,S.value.d]])]),s("div",xt,[e[24]||(e[24]=s("span",{style:{"font-size":"12px"}},"e (Error)",-1)),Z(s("input",{type:"color","onUpdate:modelValue":e[6]||(e[6]=l=>S.value.e=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[ee,S.value.e]])])])]),_:1})]),s("main",bt,[s("div",wt,[s("div",kt,[s("span",Ct,a(we.value),1),r(I,{color:"#2db7f5"},{default:o(()=>[i(a(m.value.length)+" Events",1)]),_:1})]),r(L,{size:"small",onClick:$e,title:"Download filtered logs as CSV"},{icon:o(()=>[...e[26]||(e[26]=[i("ðŸ“¥",-1)])]),default:o(()=>[e[27]||(e[27]=i(" Export CSV ",-1))]),_:1})]),e[32]||(e[32]=He('<div class="log-row header-row"><div class="col-time">Time</div><div class="col-level">Lvl</div><div class="col-tag">Tag</div><div class="col-status">Status</div><div class="col-method">Mthd</div><div class="col-path">Path / Content</div><div class="col-meta">Client</div></div>',1)),s("div",{class:"log-list",ref_key:"listRef",ref:_,onScroll:Te},[s("div",{style:D({height:`${Se.value}px`,position:"relative"})},[s("div",{style:D({transform:`translateY(${Le.value}px)`})},[(d(!0),f(B,null,X(Ce.value,l=>{var _e;return d(),f("div",{key:l.id,class:"log-row",onClick:A=>ue(l)},[s("div",{class:"col-time",title:l.time},a(l.timeOnly),9,Lt),s("div",Tt,[r(I,{color:re(l.level),style:{"font-size":"10px","min-width":"45px","text-align":"center",margin:"0"}},{default:o(()=>[i(a((l.level||"info").toUpperCase()),1)]),_:2},1032,["color"])]),s("div",It,[l.tag?(d(),f("span",{key:0,class:"small-badge",onClick:H(A=>{O.value=l.tag,U()},["stop"])},a(l.tag),9,Dt)):(d(),f("span",zt,"-"))]),s("div",{class:xe(["col-status status-badge",ce(l.status)])},a(l.status),3),s("div",{class:"col-method",style:D({color:de(l.method)})},a(l.method),5),s("div",{class:"col-path",style:D(ie(l))},[s("div",Ot,[l.path?(d(),f(B,{key:0},[s("span",{style:{"font-weight":"500"},innerHTML:ze(((_e=ae(l))==null?void 0:_e.text)||Ue(l.path))},null,8,qt),ve(l)&&!ae(l)?(d(),f("span",{key:0,class:"query-string",style:D(ie(l))},"?"+a(ve(l)),5)):b("",!0)],64)):(d(),f("span",Et,a(l.raw),1))]),s("div",Pt,[l.body&&l.body!=="-"?(d(),E(Re,{key:0,placement:"bottom",title:"Request Body",trigger:"hover"},{content:o(()=>[s("div",{class:"popover-json",style:D({color:C.value?"#e2e8f0":"#333"})},a(l.body),5)]),default:o(()=>[r(I,{color:"orange",style:{"margin-left":"8px",cursor:"pointer","border-radius":"2px"},title:"Click to Inspect Body"},{default:o(()=>[...e[28]||(e[28]=[i("BODY",-1)])]),_:1})]),_:2},1024)):b("",!0)])],4),s("div",Ut,[s("div",jt,[r(L,{type:"text",size:"small",onClick:H(A=>Oe(l),["stop"]),title:"Copy Log"},{icon:o(()=>[...e[29]||(e[29]=[i("ðŸ“‹",-1)])]),_:1},8,["onClick"]),r(L,{type:"text",size:"small",onClick:H(A=>ue(l),["stop"]),title:"View Details"},{icon:o(()=>[...e[30]||(e[30]=[i("ðŸ”",-1)])]),_:1},8,["onClick"])]),l.device_id?(d(),E(K,{key:0,title:l.device_id},{default:o(()=>[r(I,{color:"blue",bordered:!1,class:"meta-tag",onClick:H(A=>{z.value=l.device_id,U()},["stop"]),style:{cursor:"pointer"}},{default:o(()=>[i(a(je(l.device_id)),1)]),_:2},1032,["onClick"])]),_:2},1032,["title"])):b("",!0),l.os?(d(),E(K,{key:1,title:l.ua},{default:o(()=>[r(I,{bordered:!1,class:"meta-tag"},{default:o(()=>[i(a(l.os),1)]),_:2},1024)]),_:2},1032,["title"])):b("",!0),l.device==="Mobile"?(d(),E(K,{key:2,title:"Mobile Device"},{default:o(()=>[...e[31]||(e[31]=[s("span",null,"ðŸ“±",-1)])]),_:1})):b("",!0)])],8,St)}),128))],4)],4)],544)]),r(Ae,{open:J.value,"onUpdate:open":e[7]||(e[7]=l=>J.value=l),title:"Log Entry Details",placement:"right",width:"600",closable:!0,"body-style":{padding:"0"}},{default:o(()=>[u.value?(d(),f("div",Mt,[s("div",Vt,[e[38]||(e[38]=s("h3",null,"Basic Info",-1)),s("div",$t,[s("div",Rt,[e[33]||(e[33]=s("span",null,"ID",-1)),s("strong",null,a(u.value.id),1)]),s("div",At,[e[34]||(e[34]=s("span",null,"Time",-1)),s("strong",null,a(u.value.time),1)]),s("div",Bt,[e[35]||(e[35]=s("span",null,"Status",-1)),s("strong",{class:xe(ce(u.value.status))},a(u.value.status),3)]),s("div",Nt,[e[36]||(e[36]=s("span",null,"Method",-1)),s("strong",{style:D({color:de(u.value.method)})},a(u.value.method),5)]),s("div",Ht,[e[37]||(e[37]=s("span",null,"IP Address",-1)),s("strong",null,a(u.value.ip),1)])])]),s("div",Ft,[e[42]||(e[42]=s("h3",null,"Request",-1)),s("div",Jt,[e[39]||(e[39]=s("span",null,"Path",-1)),s("code",Wt,a(u.value.path),1)]),u.value.query?(d(),f("div",Yt,[e[40]||(e[40]=s("span",null,"Query",-1)),s("code",Gt,a(u.value.query),1)])):b("",!0),u.value.body?(d(),f("div",Qt,[e[41]||(e[41]=s("span",null,"Body",-1)),s("code",Kt,a(u.value.body),1)])):b("",!0)]),s("div",Xt,[e[49]||(e[49]=s("h3",null,"Client Details",-1)),s("div",Zt,[s("div",es,[e[43]||(e[43]=s("span",null,"Device ID",-1)),r(I,{color:"blue"},{default:o(()=>[i(a(u.value.device_id||"N/A"),1)]),_:1})]),s("div",ts,[e[44]||(e[44]=s("span",null,"Level",-1)),r(I,{color:re(u.value.level)},{default:o(()=>[i(a(u.value.level||"info"),1)]),_:1},8,["color"])]),s("div",ss,[e[45]||(e[45]=s("span",null,"Tag",-1)),u.value.tag?(d(),E(I,{key:0},{default:o(()=>[i(a(u.value.tag),1)]),_:1})):b("",!0)]),s("div",ls,[e[46]||(e[46]=s("span",null,"Browser",-1)),s("strong",null,a(u.value.browser),1)]),s("div",os,[e[47]||(e[47]=s("span",null,"OS",-1)),s("strong",null,a(u.value.os),1)])]),s("div",ns,[e[48]||(e[48]=s("span",null,"User Agent",-1)),s("div",as,a(u.value.ua),1)])]),s("div",is,[e[50]||(e[50]=s("h3",null,"Raw Content",-1)),s("pre",rs,a(u.value.raw),1)])])):b("",!0)]),_:1},8,["open"])])}}},ds=Fe(us);ds.mount("#app");
