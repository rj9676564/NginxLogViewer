import{x as v,w as he,k as z,o as Ae,e as He,ac as d,ad as f,ae as s,l as u,af as n,ag as a,ah as Je,ai as D,F as R,aj as X,E as A,X as i,ak as E,al as x,J as Z,am as ee,V as H,an as xe,ao as Fe}from"./vendor-aa91f45f.js";import{A as We,I as Ye,_ as Ge,B as Qe,C as Ke,a as Xe,b as Ze,S as et,c as tt,d as st,e as lt}from"./vendor-antd-9d62bf7e.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))T(c);new MutationObserver(c=>{for(const p of c)if(p.type==="childList")for(const k of p.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&T(k)}).observe(document,{childList:!0,subtree:!0});function w(c){const p={};return c.integrity&&(p.integrity=c.integrity),c.referrerPolicy&&(p.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?p.credentials="include":c.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function T(c){if(c.ep)return;c.ep=!0;const p=w(c);fetch(c.href,p)}})();const nt={id:"app-container"},ot={class:"sidebar"},at={class:"brand"},it={class:"filter-section"},rt={class:"search-wrapper"},ut={class:"select-group"},dt={class:"sub-filters"},ct={style:{display:"flex",gap:"8px"}},vt={key:0},pt={key:1},ft={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"12px"}},mt={style:{"margin-top":"8px",display:"flex","justify-content":"space-between","font-size":"12px",color:"var(--text-secondary)"}},gt={style:{"margin-top":"4px","font-size":"12px",color:"var(--text-secondary)",display:"flex","align-items":"center",gap:"6px"}},yt={key:0,class:"pulse-dot"},_t={style:{display:"flex","flex-direction":"column",gap:"8px"}},ht={style:{display:"flex","align-items":"center","justify-content":"space-between"}},xt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},bt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},wt={class:"main"},kt={class:"navbar"},Ct={style:{display:"flex","align-items":"center",gap:"12px"}},St={style:{"font-weight":"600","font-size":"13px"}},Lt=["onClick"],Tt=["title"],It={class:"col-level"},Dt={class:"col-tag"},Ot=["onClick"],qt={key:1},zt={class:"path-container"},Et=["innerHTML"],Pt={key:1,style:{color:"var(--text-secondary)",opacity:"0.7","font-style":"italic"}},jt={class:"body-container"},Ut={class:"col-meta"},Mt={class:"row-actions"},Vt={key:0,class:"detail-content"},$t={class:"detail-section"},Bt={class:"detail-grid"},Nt={class:"grid-item"},Rt={class:"grid-item"},At={class:"grid-item"},Ht={class:"grid-item"},Jt={class:"grid-item"},Ft={key:0,class:"detail-section"},Wt={key:0,class:"grid-item full"},Yt={class:"code-block"},Gt={key:1,class:"grid-item full"},Qt={class:"code-block-pre"},Kt={class:"detail-section"},Xt={class:"detail-grid"},Zt={class:"grid-item"},es={class:"grid-item"},ts={class:"grid-item"},ss={class:"grid-item"},ls={class:"grid-item"},ns={class:"grid-item full",style:{"margin-top":"12px"}},os={class:"ua-text"},as={class:"detail-section"},is={class:"raw-pre"},U=48,te=2e3,rs={__name:"App",setup(be){const m=v([]),w=v([]),T=v([]),c=v(""),p=v(!1),k=v(!1),J=v({pv:0,uv:0}),_=v(null),we=v("access.log"),C=v(localStorage.getItem("theme")!=="light"),F=v(!1),r=v(null),se=v([]),le=v([]),O=v(void 0),P=v(void 0),q=v(void 0),S=v(JSON.parse(localStorage.getItem("levelColors"))||{v:C.value?"#cccccc":"#000000",d:"#007acc",e:"#f44747"});he(S,t=>{localStorage.setItem("levelColors",JSON.stringify(t))},{deep:!0});const ne=v(0),oe=v(800),W=v(!0),ke=z(()=>Math.ceil(oe.value/U)+5),Y=z(()=>Math.floor(ne.value/U)),Ce=z(()=>G.value.slice(Y.value,Y.value+ke.value)),Se=z(()=>G.value.length*U),Le=z(()=>Y.value*U),Te=t=>{ne.value=t.target.scrollTop,W.value=t.target.scrollTop<10},M=()=>{_.value&&(oe.value=_.value.clientHeight)},j=()=>{ye(),Q()};let V=null;const Ie=()=>{if(T.value.length===0)return;const t=[...T.value].reverse(),e=t.length,o=[...t,...m.value];if(T.value=[],o.length>te?m.value=o.slice(0,te):m.value=o,W.value)A(()=>{_.value&&(_.value.scrollTop=0)});else{const y=e*U;A(()=>{_.value&&(_.value.scrollTop+=y)})}},De=t=>{if(t.level)return t.level;if(!t.query&&!t.path)return null;let e="";if(t.query&&t.query!=="-"?e=t.query:t.path&&t.path.includes("?")&&(e=t.path.split("?")[1]),!e)return null;const o=e.split("&");for(const y of o)if(y.startsWith("level="))return y.substring(6);return null},ae=t=>{if(t.tag||t.level)return{tag:t.tag,text:t.query||t.path};if(!t.path||!t.path.startsWith("/log/"))return null;const e=t.query||(t.path.includes("?")?t.path.split("?")[1]:"");if(!e)return null;const o=new URLSearchParams(e);return{tag:o.get("tag"),text:o.get("text")}},ie=t=>{const e=De(t);return e&&S.value[e]?{color:S.value[e],fontWeight:e==="e"?"600":"normal"}:{}},Oe=t=>{if(!c.value||!t)return t;const e=c.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`(${e})`,"gi");return String(t).replace(o,'<mark class="hl">$1</mark>')},re=t=>t==="e"||t==="error"?"red":t==="d"||t==="debug"?"blue":"default",ue=t=>{r.value=t,F.value=!0},qe=t=>{const e=JSON.stringify(t,null,2);navigator.clipboard.writeText(e).then(()=>{})},ze=t=>{t.timeOnly=pe(t.time);const e=Object.freeze(t);if(p.value){w.value.unshift(e);return}T.value.push(e),V||(V=setInterval(Ie,100))},G=z(()=>{let t=m.value;if(O.value&&(t=t.filter(o=>o.device_id===O.value)),P.value&&(t=t.filter(o=>o.level===P.value)),q.value&&(t=t.filter(o=>o.tag===q.value)),!c.value)return t;const e=c.value.toLowerCase();return t.filter(o=>o.path&&o.path.toLowerCase().includes(e)||o.ip&&o.ip.includes(e)||o.device_id&&o.device_id.toLowerCase().includes(e)||o.tag&&o.tag.toLowerCase().includes(e)||o.status&&String(o.status).includes(e))}),Ee=z(()=>C.value?"#cccccc":"#333333"),Pe=()=>{C.value=!C.value,localStorage.setItem("theme",C.value?"dark":"light")};he(C,t=>{document.documentElement.setAttribute("data-theme",t?"dark":"light")},{immediate:!0});const de=t=>{const e={GET:"#4ec9b0",POST:"#569cd6",PUT:"#dcdcaa",DELETE:"#f44747"};return C.value?e[t]||"#cccccc":{GET:"#059669",POST:"#2563eb",PUT:"#d97706",DELETE:"#dc2626"}[t]||"#666"},ce=t=>t<300?"c-2xx":t<400?"c-3xx":t<500?"c-4xx":"c-5xx",je=t=>t?t.split("?")[0]:"",Ue=t=>!t||t==="unknow"?"Unknown":t.length<=6?t:t.substring(t.length-6),Me=t=>{if(!t||t==="-")return"";try{const e=JSON.parse(t);return JSON.stringify(e,null,2)}catch{return t}},ve=t=>{let e="";if(t.query&&t.query!=="-"?(e=t.query,e.startsWith("?")&&(e=e.substring(1))):t.path&&t.path.includes("?")&&(e=t.path.split("?")[1]),!e)return"";try{return decodeURIComponent(e)}catch{return e}},pe=t=>{if(!t)return"--:--:--";if(t.includes("T"))return t.split("T")[1].split(".")[0];const e=t.split(":");return e.length>=4?e.slice(1,4).join(":").split(" ")[0]:t};let $=null;const fe=()=>{const t=window.location.protocol==="https:"?"wss":"ws",e=window.location.host;$=new WebSocket(`${t}://${e}/ws`),$.onopen=()=>k.value=!0,$.onclose=()=>{k.value=!1,setTimeout(fe,2e3)},$.onmessage=o=>{try{ze(JSON.parse(o.data))}catch{}}},Ve=async()=>{try{J.value=await(await fetch("/api/stats")).json()}catch{}},me=async()=>{try{se.value=await(await fetch("/api/devices")).json()}catch{}},ge=async()=>{try{le.value=await(await fetch("/api/tags")).json()}catch{}},Q=async()=>{try{const t=new URLSearchParams;O.value&&t.set("device",O.value),P.value&&t.set("level",P.value),q.value&&t.set("tag",q.value);const e=`/api/history?${t.toString()}`,y=await(await fetch(e)).json();y&&(m.value=y.map(h=>({...h,timeOnly:pe(h.time),id:h.id||Math.random()})).map(Object.freeze),A(()=>{M(),_.value&&(_.value.scrollTop=0)}))}catch{}},$e=()=>{p.value=!p.value,p.value||(w.value.length>0&&(m.value=[...w.value,...m.value].slice(0,te),w.value=[]),A(()=>{_.value&&W.value&&(_.value.scrollTop=0)}))},ye=()=>{m.value=[],w.value=[],T.value=[]},Be=()=>{const t=G.value;if(!t.length)return;const e=["ID","Time","Level","Tag","DeviceID","Method","Path","Status","IP"],o=t.map(g=>[g.id,g.time,g.level||"info",g.tag||"",g.device_id||"",g.method,g.path,g.status,g.ip]),y=[e.join(","),...o.map(g=>g.map(B=>`"${String(B).replace(/"/g,'""')}"`).join(","))].join(`
`),h=new Blob([y],{type:"text/csv;charset=utf-8;"}),b=document.createElement("a"),L=URL.createObjectURL(h);b.setAttribute("href",L),b.setAttribute("download",`logs_export_${new Date().getTime()}.csv`),b.style.visibility="hidden",document.body.appendChild(b),b.click(),document.body.removeChild(b)};return Ae(()=>{fe(),Q(),me(),ge(),setInterval(Ve,5e3),setInterval(me,1e4),setInterval(ge,15e3),M(),window.addEventListener("resize",M)}),He(()=>{V&&clearInterval(V),window.removeEventListener("resize",M)}),(t,e)=>{const o=We,y=Ye,h=et,b=Ge,L=Qe,g=tt,B=Ke,I=Xe,Ne=st,K=lt,Re=Ze;return d(),f("div",nt,[s("aside",ot,[s("div",at,[u(o,{size:32,shape:"square"},{default:n(()=>[...e[8]||(e[8]=[i("SS",-1)])]),_:1}),e[9]||(e[9]=s("span",null,"Sonic Stellar",-1))]),s("div",it,[s("div",rt,[u(y,{value:c.value,"onUpdate:value":e[0]||(e[0]=l=>c.value=l),placeholder:"Search logs...","allow-clear":"",class:"modern-search"},{prefix:n(()=>[...e[10]||(e[10]=[i("ðŸ”",-1)])]),_:1},8,["value"])]),s("div",ut,[u(b,{value:O.value,"onUpdate:value":e[1]||(e[1]=l=>O.value=l),placeholder:"Device","show-search":"","allow-clear":"",onChange:j,class:"modern-select"},{suffixIcon:n(()=>[...e[11]||(e[11]=[i("ðŸ“±",-1)])]),default:n(()=>[(d(!0),f(R,null,X(se.value,l=>(d(),E(h,{key:l,value:l},{default:n(()=>[i(a(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",dt,[u(b,{value:P.value,"onUpdate:value":e[2]||(e[2]=l=>P.value=l),placeholder:"Level","allow-clear":"",onChange:j,class:"modern-select level-select"},{suffixIcon:n(()=>[...e[12]||(e[12]=[i("ðŸ“Š",-1)])]),default:n(()=>[u(h,{value:"v"},{default:n(()=>[...e[13]||(e[13]=[i("Verbose",-1)])]),_:1}),u(h,{value:"d"},{default:n(()=>[...e[14]||(e[14]=[i("Debug",-1)])]),_:1}),u(h,{value:"e"},{default:n(()=>[...e[15]||(e[15]=[i("Error",-1)])]),_:1})]),_:1},8,["value"]),u(b,{value:q.value,"onUpdate:value":e[3]||(e[3]=l=>q.value=l),placeholder:"Tag","show-search":"","allow-clear":"",onChange:j,class:"modern-select tag-select"},{suffixIcon:n(()=>[...e[16]||(e[16]=[i("ðŸ·ï¸",-1)])]),default:n(()=>[(d(!0),f(R,null,X(le.value,l=>(d(),E(h,{key:l,value:l},{default:n(()=>[i(a(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),s("div",ct,[u(L,{type:"primary",danger:p.value,onClick:$e,block:"",ghost:""},{icon:n(()=>[p.value?(d(),f("span",pt,"â–¶ï¸")):(d(),f("span",vt,"â¸"))]),default:n(()=>[i(" "+a(p.value?w.value.length>0?`Resume (${w.value.length})`:"Resume":"Pause"),1)]),_:1},8,["danger"]),u(L,{onClick:ye,block:""},{default:n(()=>[...e[17]||(e[17]=[i(" ðŸ—‘ Clear ",-1)])]),_:1})]),u(B,{size:"small",bordered:!1,style:{background:"var(--card-bg)","margin-top":"auto"}},{default:n(()=>[s("div",ft,[e[18]||(e[18]=s("span",{style:{"font-size":"12px","font-weight":"600",color:"var(--text-secondary)"}},"STATISTICS",-1)),u(L,{type:"text",size:"small",onClick:Pe},{default:n(()=>[i(a(C.value?"ðŸŒ™":"â˜€ï¸"),1)]),_:1})]),u(g,{title:"Total Requests",value:J.value.pv,"value-style":{color:Ee.value}},null,8,["value","value-style"]),s("div",mt,[e[19]||(e[19]=s("span",null,"Unique Visitors",-1)),s("span",null,a(J.value.uv),1)]),s("div",gt,[e[20]||(e[20]=i(" Status: ",-1)),s("span",{style:D({color:k.value?"#4ec9b0":"#f44747"})},a(k.value?"Live":"Offline"),5),k.value?(d(),f("div",yt)):x("",!0)]),u(L,{size:"small",type:"link",onClick:Q,style:{padding:"0","margin-top":"8px"}},{default:n(()=>[...e[21]||(e[21]=[i("Load History",-1)])]),_:1})]),_:1}),u(B,{size:"small",bordered:!1,style:{background:"var(--card-bg)","margin-top":"12px"}},{default:n(()=>[e[25]||(e[25]=s("div",{style:{"font-size":"11px","font-weight":"600",color:"var(--text-secondary)","margin-bottom":"8px"}},"LEVEL COLORS ",-1)),s("div",_t,[s("div",ht,[e[22]||(e[22]=s("span",{style:{"font-size":"12px"}},"v (Verbose)",-1)),Z(s("input",{type:"color","onUpdate:modelValue":e[4]||(e[4]=l=>S.value.v=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[ee,S.value.v]])]),s("div",xt,[e[23]||(e[23]=s("span",{style:{"font-size":"12px"}},"d (Debug)",-1)),Z(s("input",{type:"color","onUpdate:modelValue":e[5]||(e[5]=l=>S.value.d=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[ee,S.value.d]])]),s("div",bt,[e[24]||(e[24]=s("span",{style:{"font-size":"12px"}},"e (Error)",-1)),Z(s("input",{type:"color","onUpdate:modelValue":e[6]||(e[6]=l=>S.value.e=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[ee,S.value.e]])])])]),_:1})]),s("main",wt,[s("div",kt,[s("div",Ct,[s("span",St,a(we.value),1),u(I,{color:"#2db7f5"},{default:n(()=>[i(a(m.value.length)+" Events",1)]),_:1})]),u(L,{size:"small",onClick:Be,title:"Download filtered logs as CSV"},{icon:n(()=>[...e[26]||(e[26]=[i("ðŸ“¥",-1)])]),default:n(()=>[e[27]||(e[27]=i(" Export CSV ",-1))]),_:1})]),e[32]||(e[32]=Je('<div class="log-row header-row"><div class="col-time">Time</div><div class="col-level">Lvl</div><div class="col-tag">Tag</div><div class="col-status">Status</div><div class="col-method">Mthd</div><div class="col-path">Path / Content</div><div class="col-meta">Client</div></div>',1)),s("div",{class:"log-list",ref_key:"listRef",ref:_,onScroll:Te},[s("div",{style:D({height:`${Se.value}px`,position:"relative"})},[s("div",{style:D({transform:`translateY(${Le.value}px)`})},[(d(!0),f(R,null,X(Ce.value,l=>{var _e;return d(),f("div",{key:l.id,class:"log-row",onClick:N=>ue(l)},[s("div",{class:"col-time",title:l.time},a(l.timeOnly),9,Tt),s("div",It,[u(I,{color:re(l.level),style:{"font-size":"10px","min-width":"45px","text-align":"center",margin:"0"}},{default:n(()=>[i(a((l.level||"info").toUpperCase()),1)]),_:2},1032,["color"])]),s("div",Dt,[l.tag?(d(),f("span",{key:0,class:"small-badge",onClick:H(N=>{q.value=l.tag,j()},["stop"])},a(l.tag),9,Ot)):(d(),f("span",qt,"-"))]),s("div",{class:xe(["col-status status-badge",ce(l.status)])},a(l.status),3),s("div",{class:"col-method",style:D({color:de(l.method)})},a(l.method),5),s("div",{class:"col-path",style:D(ie(l))},[s("div",zt,[l.path?(d(),f(R,{key:0},[s("span",{style:{"font-weight":"500"},innerHTML:Oe(((_e=ae(l))==null?void 0:_e.text)||je(l.path))},null,8,Et),ve(l)&&!ae(l)?(d(),f("span",{key:0,class:"query-string",style:D(ie(l))},"?"+a(ve(l)),5)):x("",!0)],64)):(d(),f("span",Pt,a(l.raw),1))]),s("div",jt,[l.body&&l.body!=="-"?(d(),E(Ne,{key:0,placement:"bottom",title:"Request Body",trigger:"hover"},{content:n(()=>[s("div",{class:"popover-json",style:D({color:C.value?"#e2e8f0":"#333"})},a(l.body),5)]),default:n(()=>[u(I,{color:"orange",style:{"margin-left":"8px",cursor:"pointer","border-radius":"2px"},title:"Click to Inspect Body"},{default:n(()=>[...e[28]||(e[28]=[i("BODY",-1)])]),_:1})]),_:2},1024)):x("",!0)])],4),s("div",Ut,[s("div",Mt,[u(L,{type:"text",size:"small",onClick:H(N=>qe(l),["stop"]),title:"Copy Log"},{icon:n(()=>[...e[29]||(e[29]=[i("ðŸ“‹",-1)])]),_:1},8,["onClick"]),u(L,{type:"text",size:"small",onClick:H(N=>ue(l),["stop"]),title:"View Details"},{icon:n(()=>[...e[30]||(e[30]=[i("ðŸ”",-1)])]),_:1},8,["onClick"])]),l.device_id?(d(),E(K,{key:0,title:l.device_id},{default:n(()=>[u(I,{color:"blue",bordered:!1,class:"meta-tag",onClick:H(N=>{O.value=l.device_id,j()},["stop"]),style:{cursor:"pointer"}},{default:n(()=>[i(a(Ue(l.device_id)),1)]),_:2},1032,["onClick"])]),_:2},1032,["title"])):x("",!0),l.os?(d(),E(K,{key:1,title:l.ua},{default:n(()=>[u(I,{bordered:!1,class:"meta-tag"},{default:n(()=>[i(a(l.os),1)]),_:2},1024)]),_:2},1032,["title"])):x("",!0),l.device==="Mobile"?(d(),E(K,{key:2,title:"Mobile Device"},{default:n(()=>[...e[31]||(e[31]=[s("span",null,"ðŸ“±",-1)])]),_:1})):x("",!0)])],8,Lt)}),128))],4)],4)],544)]),u(Re,{open:F.value,"onUpdate:open":e[7]||(e[7]=l=>F.value=l),title:"Log Entry Details",placement:"right",width:"600",closable:!0,"body-style":{padding:"0"}},{default:n(()=>[r.value?(d(),f("div",Vt,[s("div",$t,[e[38]||(e[38]=s("h3",null,"Basic Info",-1)),s("div",Bt,[s("div",Nt,[e[33]||(e[33]=s("span",null,"ID",-1)),s("strong",null,a(r.value.id),1)]),s("div",Rt,[e[34]||(e[34]=s("span",null,"Time",-1)),s("strong",null,a(r.value.time),1)]),s("div",At,[e[35]||(e[35]=s("span",null,"Status",-1)),s("strong",{class:xe(ce(r.value.status))},a(r.value.status),3)]),s("div",Ht,[e[36]||(e[36]=s("span",null,"Method",-1)),s("strong",{style:D({color:de(r.value.method)})},a(r.value.method),5)]),s("div",Jt,[e[37]||(e[37]=s("span",null,"IP Address",-1)),s("strong",null,a(r.value.ip),1)])])]),r.value.query||r.value.body?(d(),f("div",Ft,[e[41]||(e[41]=s("h3",null,"Request Payload",-1)),r.value.query&&r.value.query!=="-"?(d(),f("div",Wt,[e[39]||(e[39]=s("span",null,"Query Parameters",-1)),s("code",Yt,a(r.value.query),1)])):x("",!0),r.value.body&&r.value.body!=="-"?(d(),f("div",Gt,[e[40]||(e[40]=s("span",null,"Body",-1)),s("pre",Qt,[s("code",null,a(Me(r.value.body)),1)])])):x("",!0)])):x("",!0),s("div",Kt,[e[48]||(e[48]=s("h3",null,"Client Details",-1)),s("div",Xt,[s("div",Zt,[e[42]||(e[42]=s("span",null,"Device ID",-1)),u(I,{color:"blue"},{default:n(()=>[i(a(r.value.device_id||"N/A"),1)]),_:1})]),s("div",es,[e[43]||(e[43]=s("span",null,"Level",-1)),u(I,{color:re(r.value.level)},{default:n(()=>[i(a(r.value.level||"info"),1)]),_:1},8,["color"])]),s("div",ts,[e[44]||(e[44]=s("span",null,"Tag",-1)),r.value.tag?(d(),E(I,{key:0},{default:n(()=>[i(a(r.value.tag),1)]),_:1})):x("",!0)]),s("div",ss,[e[45]||(e[45]=s("span",null,"Browser",-1)),s("strong",null,a(r.value.browser),1)]),s("div",ls,[e[46]||(e[46]=s("span",null,"OS",-1)),s("strong",null,a(r.value.os),1)])]),s("div",ns,[e[47]||(e[47]=s("span",null,"User Agent",-1)),s("div",os,a(r.value.ua),1)])]),s("div",as,[e[49]||(e[49]=s("h3",null,"Raw Content",-1)),s("pre",is,a(r.value.raw),1)])])):x("",!0)]),_:1},8,["open"])])}}},us=Fe(rs);us.mount("#app");
