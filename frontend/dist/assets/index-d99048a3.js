import{x as v,w as he,k as q,o as Ve,e as $e,ac as r,ad as f,ae as s,l as u,af as n,X as i,ag as o,ah as Re,ai as z,F as H,aj as X,E as Z,ak as M,al as _,J as ee,am as te,an as _e,V as A,ao as Be}from"./vendor-aa91f45f.js";import{A as Ae,_ as Ne,a as Fe,B as Je,C as We,b as Qe,c as Ye,S as Ge,d as Ke,e as Xe,f as Ze}from"./vendor-antd-525c1b97.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))T(c);new MutationObserver(c=>{for(const p of c)if(p.type==="childList")for(const k of p.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&T(k)}).observe(document,{childList:!0,subtree:!0});function w(c){const p={};return c.integrity&&(p.integrity=c.integrity),c.referrerPolicy&&(p.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?p.credentials="include":c.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function T(c){if(c.ep)return;c.ep=!0;const p=w(c);fetch(c.href,p)}})();const et={id:"app-container"},tt={class:"sidebar"},st={class:"brand"},lt={style:{display:"flex",gap:"8px","margin-bottom":"8px"}},nt={style:{display:"flex",gap:"8px"}},ot={key:0},at={key:1},it={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"12px"}},rt={style:{"margin-top":"8px",display:"flex","justify-content":"space-between","font-size":"12px",color:"var(--text-secondary)"}},ut={style:{"margin-top":"4px","font-size":"12px",color:"var(--text-secondary)",display:"flex","align-items":"center",gap:"6px"}},dt={key:0,class:"pulse-dot"},ct={style:{display:"flex","flex-direction":"column",gap:"8px"}},vt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},pt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ft={style:{display:"flex","align-items":"center","justify-content":"space-between"}},gt={class:"main"},mt={class:"navbar"},yt={style:{display:"flex","align-items":"center",gap:"12px"}},ht={style:{"font-weight":"600","font-size":"13px"}},_t=["onClick"],xt=["title"],bt={class:"path-container"},wt=["onClick"],kt=["innerHTML"],Ct=["onClick"],Lt=["innerHTML"],St=["title","innerHTML"],Tt={key:2,style:{color:"var(--text-secondary)",opacity:"0.7","font-style":"italic"}},Dt={class:"body-container"},zt={class:"col-meta"},It={class:"row-actions"},Ot={key:0,class:"detail-content"},Et={class:"detail-section"},qt={class:"detail-grid"},Mt={class:"grid-item"},Pt={class:"grid-item"},jt={class:"grid-item"},Ht={class:"grid-item"},Ut={class:"grid-item"},Vt={class:"detail-section"},$t={class:"grid-item full"},Rt={class:"code-block"},Bt={key:0,class:"grid-item full"},At={class:"code-block"},Nt={key:1,class:"grid-item full"},Ft={class:"code-block"},Jt={class:"detail-section"},Wt={class:"detail-grid"},Qt={class:"grid-item"},Yt={class:"grid-item"},Gt={class:"grid-item"},Kt={class:"grid-item"},Xt={class:"grid-item"},Zt={class:"grid-item full",style:{"margin-top":"12px"}},es={class:"ua-text"},ts={class:"detail-section"},ss={class:"raw-pre"},N=36,se=2e3,ls={__name:"App",setup(xe){const g=v([]),w=v([]),T=v([]),c=v(""),p=v(!1),k=v(!1),F=v({pv:0,uv:0}),y=v(null),be=v("access.log"),C=v(localStorage.getItem("theme")!=="light"),J=v(!1),d=v(null),le=v([]),ne=v([]),I=v(void 0),P=v(void 0),D=v(void 0),L=v(JSON.parse(localStorage.getItem("levelColors"))||{v:C.value?"#cccccc":"#000000",d:"#007acc",e:"#f44747"});he(L,t=>{localStorage.setItem("levelColors",JSON.stringify(t))},{deep:!0});const oe=v(0),ae=v(800),we=q(()=>Math.ceil(ae.value/N)+5),W=q(()=>Math.floor(oe.value/N)),ke=q(()=>Y.value.slice(W.value,W.value+we.value)),Ce=q(()=>Y.value.length*N),Le=q(()=>W.value*N),Se=t=>{oe.value=t.target.scrollTop},V=()=>{y.value&&(ae.value=y.value.clientHeight)},j=()=>{me(),K()};let $=null;const Te=()=>{if(T.value.length===0)return;const t=[...g.value,...T.value];T.value=[],t.length>se?g.value=t.slice(t.length-se):g.value=t,Z(()=>{if(y.value){const e=y.value;e.scrollHeight-e.scrollTop-e.clientHeight<200&&(e.scrollTop=e.scrollHeight)}})},De=t=>{if(t.level)return t.level;if(!t.query&&!t.path)return null;let e="";if(t.query&&t.query!=="-"?e=t.query:t.path&&t.path.includes("?")&&(e=t.path.split("?")[1]),!e)return null;const a=e.split("&");for(const x of a)if(x.startsWith("level="))return x.substring(6);return null},O=t=>{if(t.tag||t.level)return{tag:t.tag,text:t.query||t.path};if(!t.path||!t.path.startsWith("/log/"))return null;const e=t.query||(t.path.includes("?")?t.path.split("?")[1]:"");if(!e)return null;const a=new URLSearchParams(e);return{tag:a.get("tag"),text:a.get("text")}},ie=t=>{const e=De(t);return e&&L.value[e]?{color:L.value[e],fontWeight:e==="e"?"600":"normal"}:{}},Q=t=>{if(!c.value||!t)return t;const e=c.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=new RegExp(`(${e})`,"gi");return String(t).replace(a,'<mark class="hl">$1</mark>')},ze=t=>t==="e"||t==="error"?"red":t==="d"||t==="debug"?"blue":"default",re=t=>{d.value=t,J.value=!0},Ie=t=>{const e=JSON.stringify(t,null,2);navigator.clipboard.writeText(e).then(()=>{})},Oe=t=>{t.timeOnly=ve(t.time);const e=Object.freeze(t);if(p.value){w.value.push(e);return}T.value.push(e),$||($=setInterval(Te,100))},Y=q(()=>{let t=g.value;if(I.value&&(t=t.filter(a=>a.device_id===I.value)),P.value&&(t=t.filter(a=>a.level===P.value)),D.value&&(t=t.filter(a=>a.tag===D.value)),!c.value)return t;const e=c.value.toLowerCase();return t.filter(a=>a.path&&a.path.toLowerCase().includes(e)||a.ip&&a.ip.includes(e)||a.device_id&&a.device_id.toLowerCase().includes(e)||a.tag&&a.tag.toLowerCase().includes(e)||a.status&&String(a.status).includes(e))}),Ee=q(()=>C.value?"#cccccc":"#333333"),qe=()=>{C.value=!C.value,localStorage.setItem("theme",C.value?"dark":"light")};he(C,t=>{document.documentElement.setAttribute("data-theme",t?"dark":"light")},{immediate:!0});const ue=t=>{const e={GET:"#4ec9b0",POST:"#569cd6",PUT:"#dcdcaa",DELETE:"#f44747"};return C.value?e[t]||"#cccccc":{GET:"#059669",POST:"#2563eb",PUT:"#d97706",DELETE:"#dc2626"}[t]||"#666"},de=t=>t<300?"c-2xx":t<400?"c-3xx":t<500?"c-4xx":"c-5xx",G=t=>t?t.split("?")[0]:"",ce=t=>{let e="";if(t.query&&t.query!=="-"?(e=t.query,e.startsWith("?")&&(e=e.substring(1))):t.path&&t.path.includes("?")&&(e=t.path.split("?")[1]),!e)return"";try{return decodeURIComponent(e)}catch{return e}},ve=t=>{if(!t)return"--:--:--";const e=t.split(":");return e.length>=4?e.slice(1,4).join(":").split(" ")[0]:t};let R=null;const pe=()=>{const t=window.location.protocol==="https:"?"wss":"ws",e=window.location.host;R=new WebSocket(`${t}://${e}/ws`),R.onopen=()=>k.value=!0,R.onclose=()=>{k.value=!1,setTimeout(pe,2e3)},R.onmessage=a=>{try{Oe(JSON.parse(a.data))}catch{}}},Me=async()=>{try{F.value=await(await fetch("/api/stats")).json()}catch{}},fe=async()=>{try{le.value=await(await fetch("/api/devices")).json()}catch{}},ge=async()=>{try{ne.value=await(await fetch("/api/tags")).json()}catch{}},K=async()=>{try{const t=new URLSearchParams;I.value&&t.set("device",I.value),P.value&&t.set("level",P.value),D.value&&t.set("tag",D.value);const e=`/api/history?${t.toString()}`,x=await(await fetch(e)).json();x&&(g.value=x.reverse().map(h=>({...h,timeOnly:ve(h.time),id:h.id||Math.random()})).map(Object.freeze),Z(()=>{V(),y.value&&(y.value.scrollTop=y.value.scrollHeight)}))}catch{}},Pe=()=>{p.value=!p.value,p.value||(w.value.length>0&&(g.value=[...g.value,...w.value].slice(-se),w.value=[]),Z(()=>{y.value&&(y.value.scrollTop=y.value.scrollHeight)}))},me=()=>{g.value=[],w.value=[],T.value=[]},je=()=>{const t=Y.value;if(!t.length)return;const e=["ID","Time","Level","Tag","DeviceID","Method","Path","Status","IP"],a=t.map(m=>[m.id,m.time,m.level||"info",m.tag||"",m.device_id||"",m.method,m.path,m.status,m.ip]),x=[e.join(","),...a.map(m=>m.map(B=>`"${String(B).replace(/"/g,'""')}"`).join(","))].join(`
`),h=new Blob([x],{type:"text/csv;charset=utf-8;"}),b=document.createElement("a"),S=URL.createObjectURL(h);b.setAttribute("href",S),b.setAttribute("download",`logs_export_${new Date().getTime()}.csv`),b.style.visibility="hidden",document.body.appendChild(b),b.click(),document.body.removeChild(b)};return Ve(()=>{pe(),K(),fe(),ge(),setInterval(Me,5e3),setInterval(fe,1e4),setInterval(ge,15e3),V(),window.addEventListener("resize",V)}),$e(()=>{$&&clearInterval($),window.removeEventListener("resize",V)}),(t,e)=>{const a=Ae,x=Ne,h=Ge,b=Fe,S=Je,m=Ke,B=We,E=Qe,He=Xe,ye=Ze,Ue=Ye;return r(),f("div",et,[s("aside",tt,[s("div",st,[u(a,{size:"small",style:{"background-color":"var(--accent-color)"}},{icon:n(()=>[...e[8]||(e[8]=[i("âš¡ï¸",-1)])]),_:1}),e[9]||(e[9]=i(" Sonic Stellar ",-1))]),u(x,{value:c.value,"onUpdate:value":e[0]||(e[0]=l=>c.value=l),placeholder:"Filter text...","allow-clear":"",style:{"margin-bottom":"8px"}},null,8,["value"]),u(b,{value:I.value,"onUpdate:value":e[1]||(e[1]=l=>I.value=l),placeholder:"Search/Select Device","show-search":"","allow-clear":"",style:{width:"100%","margin-bottom":"8px"},onChange:j},{suffixIcon:n(()=>[...e[10]||(e[10]=[i("ðŸ“±",-1)])]),default:n(()=>[(r(!0),f(H,null,X(le.value,l=>(r(),M(h,{key:l,value:l},{default:n(()=>[i(o(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s("div",lt,[u(b,{value:P.value,"onUpdate:value":e[2]||(e[2]=l=>P.value=l),placeholder:"Level","allow-clear":"",style:{flex:"1"},onChange:j},{suffixIcon:n(()=>[...e[11]||(e[11]=[i("ðŸ“Š",-1)])]),default:n(()=>[u(h,{value:"v"},{default:n(()=>[...e[12]||(e[12]=[i("Verbose",-1)])]),_:1}),u(h,{value:"d"},{default:n(()=>[...e[13]||(e[13]=[i("Debug",-1)])]),_:1}),u(h,{value:"e"},{default:n(()=>[...e[14]||(e[14]=[i("Error",-1)])]),_:1})]),_:1},8,["value"]),u(b,{value:D.value,"onUpdate:value":e[3]||(e[3]=l=>D.value=l),placeholder:"Tag","show-search":"","allow-clear":"",style:{flex:"1.5"},onChange:j},{suffixIcon:n(()=>[...e[15]||(e[15]=[i("ðŸ·ï¸",-1)])]),default:n(()=>[(r(!0),f(H,null,X(ne.value,l=>(r(),M(h,{key:l,value:l},{default:n(()=>[i(o(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),s("div",nt,[u(S,{type:"primary",danger:p.value,onClick:Pe,block:"",ghost:""},{icon:n(()=>[p.value?(r(),f("span",at,"â–¶ï¸")):(r(),f("span",ot,"â¸"))]),default:n(()=>[i(" "+o(p.value?w.value.length>0?`Resume (${w.value.length})`:"Resume":"Pause"),1)]),_:1},8,["danger"]),u(S,{onClick:me,block:""},{default:n(()=>[...e[16]||(e[16]=[i(" ðŸ—‘ Clear ",-1)])]),_:1})]),u(B,{size:"small",bordered:!1,style:{background:"var(--card-bg)","margin-top":"auto"}},{default:n(()=>[s("div",it,[e[17]||(e[17]=s("span",{style:{"font-size":"12px","font-weight":"600",color:"var(--text-secondary)"}},"STATISTICS",-1)),u(S,{type:"text",size:"small",onClick:qe},{default:n(()=>[i(o(C.value?"ðŸŒ™":"â˜€ï¸"),1)]),_:1})]),u(m,{title:"Total Requests",value:F.value.pv,"value-style":{color:Ee.value}},null,8,["value","value-style"]),s("div",rt,[e[18]||(e[18]=s("span",null,"Unique Visitors",-1)),s("span",null,o(F.value.uv),1)]),s("div",ut,[e[19]||(e[19]=i(" Status: ",-1)),s("span",{style:z({color:k.value?"#4ec9b0":"#f44747"})},o(k.value?"Live":"Offline"),5),k.value?(r(),f("div",dt)):_("",!0)]),u(S,{size:"small",type:"link",onClick:K,style:{padding:"0","margin-top":"8px"}},{default:n(()=>[...e[20]||(e[20]=[i("Load History",-1)])]),_:1})]),_:1}),u(B,{size:"small",bordered:!1,style:{background:"var(--card-bg)","margin-top":"12px"}},{default:n(()=>[e[24]||(e[24]=s("div",{style:{"font-size":"11px","font-weight":"600",color:"var(--text-secondary)","margin-bottom":"8px"}},"LEVEL COLORS ",-1)),s("div",ct,[s("div",vt,[e[21]||(e[21]=s("span",{style:{"font-size":"12px"}},"v (Verbose)",-1)),ee(s("input",{type:"color","onUpdate:modelValue":e[4]||(e[4]=l=>L.value.v=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[te,L.value.v]])]),s("div",pt,[e[22]||(e[22]=s("span",{style:{"font-size":"12px"}},"d (Debug)",-1)),ee(s("input",{type:"color","onUpdate:modelValue":e[5]||(e[5]=l=>L.value.d=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[te,L.value.d]])]),s("div",ft,[e[23]||(e[23]=s("span",{style:{"font-size":"12px"}},"e (Error)",-1)),ee(s("input",{type:"color","onUpdate:modelValue":e[6]||(e[6]=l=>L.value.e=l),style:{border:"none",padding:"0",width:"24px",height:"24px",cursor:"pointer",background:"transparent"}},null,512),[[te,L.value.e]])])])]),_:1})]),s("main",gt,[s("div",mt,[s("div",yt,[s("span",ht,o(be.value),1),u(E,{color:"#2db7f5"},{default:n(()=>[i(o(g.value.length)+" Events",1)]),_:1})]),u(S,{size:"small",onClick:je,title:"Download filtered logs as CSV"},{icon:n(()=>[...e[25]||(e[25]=[i("ðŸ“¥",-1)])]),default:n(()=>[e[26]||(e[26]=i(" Export CSV ",-1))]),_:1})]),e[31]||(e[31]=Re('<div class="log-row header-row"><div class="col-time">Time</div><div class="col-status">Status</div><div class="col-method">Method</div><div class="col-path">Path / Query</div><div class="col-meta">Client</div></div>',1)),s("div",{class:"log-list",ref_key:"listRef",ref:y,onScroll:Se},[s("div",{style:z({height:`${Ce.value}px`,position:"relative"})},[s("div",{style:z({transform:`translateY(${Le.value}px)`})},[(r(!0),f(H,null,X(ke.value,l=>(r(),f("div",{key:l.id,class:"log-row",onClick:U=>re(l)},[s("div",{class:"col-time",title:l.time},o(l.timeOnly),9,xt),s("div",{class:_e(["col-status status-badge",de(l.status)])},o(l.status),3),s("div",{class:"col-method",style:z({color:ue(l.method)})},o(l.method),5),s("div",{class:"col-path",style:z(ie(l))},[s("div",bt,[l.device_id?(r(),M(E,{key:0,size:"small",color:"blue",style:{"margin-right":"4px","font-size":"10px",cursor:"pointer"},onClick:U=>{I.value=l.device_id,j()}},{default:n(()=>[i(o(l.device_id),1)]),_:2},1032,["onClick"])):_("",!0),l.path?(r(),f(H,{key:1},[l.tag?(r(),f(H,{key:0},[s("span",{style:{background:"var(--tag-bg)",padding:"0 4px","border-radius":"3px","margin-right":"4px","font-weight":"600",cursor:"pointer"},onClick:A(U=>{D.value=l.tag,j()},["stop"])},o(l.tag),9,wt),s("span",{style:{"font-weight":"500"},innerHTML:Q(O(l).text||G(l.path))},null,8,kt)],64)):O(l)?(r(),f(H,{key:1},[O(l).tag?(r(),f("span",{key:0,style:{background:"var(--tag-bg)",padding:"0 4px","border-radius":"3px","margin-right":"4px","font-weight":"600",cursor:"pointer"},onClick:A(U=>{D.value=O(l).tag,j()},["stop"])},o(O(l).tag),9,Ct)):_("",!0),s("span",{style:{"font-weight":"500"},innerHTML:Q(O(l).text||G(l.path))},null,8,Lt)],64)):(r(),f("span",{key:2,title:l.path,innerHTML:Q(G(l.path))},null,8,St)),ce(l)&&!O(l)&&!l.tag?(r(),f("span",{key:3,class:"query-string",style:z(ie(l))},"?"+o(ce(l)),5)):_("",!0)],64)):(r(),f("span",Tt,o(l.raw),1))]),s("div",Dt,[l.body&&l.body!=="-"?(r(),M(He,{key:0,placement:"bottom",title:"Request Body",trigger:"hover"},{content:n(()=>[s("div",{class:"popover-json",style:z({color:C.value?"#e2e8f0":"#333"})},o(l.body),5)]),default:n(()=>[u(E,{color:"orange",style:{"margin-left":"8px",cursor:"pointer","border-radius":"2px"},title:"Click to Inspect Body"},{default:n(()=>[...e[27]||(e[27]=[i("BODY",-1)])]),_:1})]),_:2},1024)):_("",!0)])],4),s("div",zt,[s("div",It,[u(S,{type:"text",size:"small",onClick:A(U=>Ie(l),["stop"]),title:"Copy Log"},{icon:n(()=>[...e[28]||(e[28]=[i("ðŸ“‹",-1)])]),_:1},8,["onClick"]),u(S,{type:"text",size:"small",onClick:A(U=>re(l),["stop"]),title:"View Details"},{icon:n(()=>[...e[29]||(e[29]=[i("ðŸ”",-1)])]),_:1},8,["onClick"])]),l.os?(r(),M(ye,{key:0,title:l.ua},{default:n(()=>[u(E,{bordered:!1,class:"meta-tag"},{default:n(()=>[i(o(l.os),1)]),_:2},1024)]),_:2},1032,["title"])):_("",!0),l.device==="Mobile"?(r(),M(ye,{key:1,title:"Mobile Device"},{default:n(()=>[...e[30]||(e[30]=[s("span",null,"ðŸ“±",-1)])]),_:1})):_("",!0)])],8,_t))),128))],4)],4)],544)]),u(Ue,{open:J.value,"onUpdate:open":e[7]||(e[7]=l=>J.value=l),title:"Log Entry Details",placement:"right",width:"600",closable:!0,"body-style":{padding:"0"}},{default:n(()=>[d.value?(r(),f("div",Ot,[s("div",Et,[e[37]||(e[37]=s("h3",null,"Basic Info",-1)),s("div",qt,[s("div",Mt,[e[32]||(e[32]=s("span",null,"ID",-1)),s("strong",null,o(d.value.id),1)]),s("div",Pt,[e[33]||(e[33]=s("span",null,"Time",-1)),s("strong",null,o(d.value.time),1)]),s("div",jt,[e[34]||(e[34]=s("span",null,"Status",-1)),s("strong",{class:_e(de(d.value.status))},o(d.value.status),3)]),s("div",Ht,[e[35]||(e[35]=s("span",null,"Method",-1)),s("strong",{style:z({color:ue(d.value.method)})},o(d.value.method),5)]),s("div",Ut,[e[36]||(e[36]=s("span",null,"IP Address",-1)),s("strong",null,o(d.value.ip),1)])])]),s("div",Vt,[e[41]||(e[41]=s("h3",null,"Request",-1)),s("div",$t,[e[38]||(e[38]=s("span",null,"Path",-1)),s("code",Rt,o(d.value.path),1)]),d.value.query?(r(),f("div",Bt,[e[39]||(e[39]=s("span",null,"Query",-1)),s("code",At,o(d.value.query),1)])):_("",!0),d.value.body?(r(),f("div",Nt,[e[40]||(e[40]=s("span",null,"Body",-1)),s("code",Ft,o(d.value.body),1)])):_("",!0)]),s("div",Jt,[e[48]||(e[48]=s("h3",null,"Client Details",-1)),s("div",Wt,[s("div",Qt,[e[42]||(e[42]=s("span",null,"Device ID",-1)),u(E,{color:"blue"},{default:n(()=>[i(o(d.value.device_id||"N/A"),1)]),_:1})]),s("div",Yt,[e[43]||(e[43]=s("span",null,"Level",-1)),u(E,{color:ze(d.value.level)},{default:n(()=>[i(o(d.value.level||"info"),1)]),_:1},8,["color"])]),s("div",Gt,[e[44]||(e[44]=s("span",null,"Tag",-1)),d.value.tag?(r(),M(E,{key:0},{default:n(()=>[i(o(d.value.tag),1)]),_:1})):_("",!0)]),s("div",Kt,[e[45]||(e[45]=s("span",null,"Browser",-1)),s("strong",null,o(d.value.browser),1)]),s("div",Xt,[e[46]||(e[46]=s("span",null,"OS",-1)),s("strong",null,o(d.value.os),1)])]),s("div",Zt,[e[47]||(e[47]=s("span",null,"User Agent",-1)),s("div",es,o(d.value.ua),1)])]),s("div",ts,[e[49]||(e[49]=s("h3",null,"Raw Content",-1)),s("pre",ss,o(d.value.raw),1)])])):_("",!0)]),_:1},8,["open"])])}}},ns=Be(ls);ns.mount("#app");
